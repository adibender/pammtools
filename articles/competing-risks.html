<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Competing Risks • pammtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Competing Risks">
<meta property="og:description" content="pammtools">
<meta property="og:image" content="https://adibender.github.io/pammtools/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44545040-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44545040-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pammtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.92</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-transformation.html">Data transformation</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Estimating the baseline hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic modeling</a>
    </li>
    <li>
      <a href="../articles/splines.html">Non-linear effects (penalized splines)</a>
    </li>
    <li>
      <a href="../articles/convenience.html">Workflow and convenience functions</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified models</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects (TVEs)</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailties (random effects)</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates (TDCs)</a>
    </li>
    <li>
      <a href="../articles/left-truncation.html">Left-truncated data</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/cumulative-effects.html">Cumulative effects/Exposure-Lag-Response Associations</a>
    </li>
    <li>
      <a href="../articles/competing-risks.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent Events</a>
    </li>
    <li>
      <a href="../articles/smj-tutorial.html">Paper: A generalized additive model approach to time-to-event analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/pammtools" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Competing Risks</h1>
                        <h4 data-toc-skip class="author">Andreas
Bender</h4>
            
            <h4 data-toc-skip class="date">2024-02-24</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/pammtools/blob/HEAD/vignettes/competing-risks.Rmd" class="external-link"><code>vignettes/competing-risks.Rmd</code></a></small>
      <div class="hidden name"><code>competing-risks.Rmd</code></div>

    </div>

    
    
<p>In this article we illustrate how to fit cause specific hazards
models to competing risks data. The standard way to estimate cause
specific hazards is to create one data set for each event type and fit a
separate model. However, it is also possible to create one combined data
set and enter the event type as a covariate (with interactions), such
that it is possible to estimate shared effects (i.e., effects that
contribute equally to the hazard of multiple event types).</p>
<div class="section level2">
<h2 id="fourd-data">
<code>fourD</code> Data<a class="anchor" aria-label="anchor" href="#fourd-data"></a>
</h2>
<p>For illustration we use the <code>fourD</code> data set from the
<strong><code>etm</code></strong> package. The data set contains
time-constant covariates like <code>age</code> and <code>sex</code> as
well as time-to-event (<code>time</code>) and event type indicator
<code>status</code> (0 = censored, 1 = death from cardiovascular events,
2 = death from other causes).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/">pammtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"fourD"</span>, package <span class="op">=</span> <span class="st">"etm"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">fourD</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      id    sex age medication status      time treated</span></span>
<span><span class="co">## 1  5002   Male  60    Placebo      0 5.8480493       0</span></span>
<span><span class="co">## 4  5006 Female  68    Placebo      0 5.2539357       0</span></span>
<span><span class="co">## 7  5011 Female  70    Placebo      1 2.9541410       0</span></span>
<span><span class="co">## 9  5014   Male  69    Placebo      1 0.9856263       0</span></span>
<span><span class="co">## 10 5017 Female  58    Placebo      1 0.2902122       0</span></span>
<span><span class="co">## 11 5018   Male  63    Placebo      1 3.9452430       0</span></span></code></pre>
<div class="section level3">
<h3 id="data-transformation">Data transformation<a class="anchor" aria-label="anchor" href="#data-transformation"></a>
</h3>
<p>The data transformation required to fit PAMMs to competing risks data
is similar to the transformation in the single event case (see the <a href="https://adibender.github.io/pammtools/articles/data-transformation.html">data
transformation vignette</a> for details). In fact, internally the
standard transformation is applied to each event type using
<code>as_ped</code>, however, some choices have to be made</p>
<ul>
<li>use the same or different interval split points for the different
event types?</li>
<li>return the data as a list (one element for each event type) or a
stacked data set (with an additional column (covariate), indicating the
event type)</li>
</ul>
<p>For cause specific hazards without shared effects the combination of
cause specific interval split points and list output is usually
sufficient. For models with shared effects we need to stack the
individual data sets and use split points common for all event
types.</p>
</div>
<div class="section level3">
<h3 id="cause-specific-hazards-model-without-shared-effects">Cause specific hazards model without shared effects<a class="anchor" aria-label="anchor" href="#cause-specific-hazards-model-without-shared-effects"></a>
</h3>
<p>Below we transform the data set for the case without shared effects.
By specifying <code>cobmine = FALSE</code>, the individual data sets are
not stacked but rather returned in a list.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">fourD</span><span class="op">$</span><span class="va">time</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">ped</span> <span class="op">&lt;-</span> <span class="va">fourD</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">medication</span>, <span class="op">-</span> <span class="va">treated</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, id <span class="op">=</span> <span class="st">"id"</span>, cut <span class="op">=</span> <span class="va">cut</span>, combine <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ped</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ cause = 1:Classes 'ped' and 'data.frame': 29807 obs. of  9 variables:</span></span>
<span><span class="co">##   ..- attr(*, "breaks")= num [1:94] 0.192 0.274 0.312 0.32 0.329 ...</span></span>
<span><span class="co">##   ..- attr(*, "id_var")= chr "id"</span></span>
<span><span class="co">##   ..- attr(*, "intvars")= chr [1:6] "id" "tstart" "tend" "interval" ...</span></span>
<span><span class="co">##   ..- attr(*, "trafo_args")=List of 3</span></span>
<span><span class="co">##   ..- attr(*, "time_var")= chr "time"</span></span>
<span><span class="co">##   ..- attr(*, "status_var")= chr "status"</span></span>
<span><span class="co">##  $ cause = 2:Classes 'ped' and 'data.frame': 29807 obs. of  9 variables:</span></span>
<span><span class="co">##   ..- attr(*, "breaks")= num [1:94] 0.192 0.274 0.312 0.32 0.329 ...</span></span>
<span><span class="co">##   ..- attr(*, "id_var")= chr "id"</span></span>
<span><span class="co">##   ..- attr(*, "intvars")= chr [1:6] "id" "tstart" "tend" "interval" ...</span></span>
<span><span class="co">##   ..- attr(*, "trafo_args")=List of 3</span></span>
<span><span class="co">##   ..- attr(*, "time_var")= chr "time"</span></span>
<span><span class="co">##   ..- attr(*, "status_var")= chr "status"</span></span>
<span><span class="co">##  - attr(*, "class")= chr [1:4] "ped_cr_list" "ped_cr" "ped" "list"</span></span>
<span><span class="co">##  - attr(*, "trafo_args")=List of 5</span></span>
<span><span class="co">##  - attr(*, "risks")= int [1:2] 1 2</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data set for event type 1 (death from cardiovascular events)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ped</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     id    tstart      tend                    interval    offset ped_status</span></span>
<span><span class="co">## 1 5002 0.0000000 0.1916496            (0,0.1916495551] -1.652087          0</span></span>
<span><span class="co">## 2 5002 0.1916496 0.2737851 (0.1916495551,0.2737850787] -2.499385          0</span></span>
<span><span class="co">## 3 5002 0.2737851 0.3121150 (0.2737850787,0.3121149897] -3.261525          0</span></span>
<span><span class="co">## 4 5002 0.3121150 0.3203285 (0.3121149897,0.3203285421] -4.801970          0</span></span>
<span><span class="co">## 5 5002 0.3203285 0.3285421 (0.3203285421,0.3285420945] -4.801970          0</span></span>
<span><span class="co">## 6 5002 0.3285421 0.3969884 (0.3285420945,0.3969883641] -2.681706          0</span></span>
<span><span class="co">##    sex age cause</span></span>
<span><span class="co">## 1 Male  60     1</span></span>
<span><span class="co">## 2 Male  60     1</span></span>
<span><span class="co">## 3 Male  60     1</span></span>
<span><span class="co">## 4 Male  60     1</span></span>
<span><span class="co">## 5 Male  60     1</span></span>
<span><span class="co">## 6 Male  60     1</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data set for event type 2 (death from other causes)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ped</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     id    tstart      tend                    interval    offset ped_status</span></span>
<span><span class="co">## 1 5002 0.0000000 0.1916496            (0,0.1916495551] -1.652087          0</span></span>
<span><span class="co">## 2 5002 0.1916496 0.2737851 (0.1916495551,0.2737850787] -2.499385          0</span></span>
<span><span class="co">## 3 5002 0.2737851 0.3121150 (0.2737850787,0.3121149897] -3.261525          0</span></span>
<span><span class="co">## 4 5002 0.3121150 0.3203285 (0.3121149897,0.3203285421] -4.801970          0</span></span>
<span><span class="co">## 5 5002 0.3203285 0.3285421 (0.3203285421,0.3285420945] -4.801970          0</span></span>
<span><span class="co">## 6 5002 0.3285421 0.3969884 (0.3285420945,0.3969883641] -2.681706          0</span></span>
<span><span class="co">##    sex age cause</span></span>
<span><span class="co">## 1 Male  60     2</span></span>
<span><span class="co">## 2 Male  60     2</span></span>
<span><span class="co">## 3 Male  60     2</span></span>
<span><span class="co">## 4 Male  60     2</span></span>
<span><span class="co">## 5 Male  60     2</span></span>
<span><span class="co">## 6 Male  60     2</span></span></code></pre>
<p>To fit the model, we could loop through the list entries and fit the
model of interest, however, there is also a convenience function, that
recognizes the data type and fits the models accordingly:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="va">pam_csh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">ped</span>, <span class="op">~</span> <span class="fu"><a href="../reference/pamm.html">pamm</a></span><span class="op">(</span><span class="va">ped_status</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">pam_csh</span>, <span class="va">summary</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $`cause = 1`</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ s(tend) + sex + age</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept) -3.17557    0.58527  -5.426 5.77e-08 ***</span></span>
<span><span class="co">## sexMale     -0.13712    0.13226  -1.037   0.2999    </span></span>
<span><span class="co">## age          0.02013    0.00847   2.376   0.0175 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##           edf Ref.df Chi.sq p-value   </span></span>
<span><span class="co">## s(tend) 1.003  1.007  7.327 0.00687 **</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.00892   Deviance explained = 0.545%</span></span>
<span><span class="co">## UBRE = -0.91143  Scale est. = 1         n = 29807</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`cause = 2`</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ s(tend) + sex + age</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##             Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept) -6.95012    0.88239  -7.877 3.37e-15 ***</span></span>
<span><span class="co">## sexMale      0.16840    0.18029   0.934     0.35    </span></span>
<span><span class="co">## age          0.06415    0.01244   5.158 2.49e-07 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##          edf Ref.df Chi.sq p-value   </span></span>
<span><span class="co">## s(tend) 1.02  1.039  10.13 0.00155 **</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.00383   Deviance explained =  2.3%</span></span>
<span><span class="co">## UBRE = -0.94888  Scale est. = 1         n = 29807</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="cause-specific-hazards-with-shared-effects">Cause specific hazards with shared effects<a class="anchor" aria-label="anchor" href="#cause-specific-hazards-with-shared-effects"></a>
</h3>
<p>The data transformation is performed as before, but setting
<code>combine=TRUE</code> (the default), the interval cut points are
created based on all event times (event times of all event types, here)
and stacked:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped_stacked</span> <span class="op">&lt;-</span> <span class="va">fourD</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">medication</span>, <span class="op">-</span> <span class="va">treated</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, id <span class="op">=</span> <span class="st">"id"</span>, cut <span class="op">=</span> <span class="va">cut</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>cause <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ped_stacked</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     id    tstart      tend                    interval    offset ped_status</span></span>
<span><span class="co">## 1 5002 0.0000000 0.1916496            (0,0.1916495551] -1.652087          0</span></span>
<span><span class="co">## 2 5002 0.1916496 0.2737851 (0.1916495551,0.2737850787] -2.499385          0</span></span>
<span><span class="co">## 3 5002 0.2737851 0.3121150 (0.2737850787,0.3121149897] -3.261525          0</span></span>
<span><span class="co">## 4 5002 0.3121150 0.3203285 (0.3121149897,0.3203285421] -4.801970          0</span></span>
<span><span class="co">## 5 5002 0.3203285 0.3285421 (0.3203285421,0.3285420945] -4.801970          0</span></span>
<span><span class="co">## 6 5002 0.3285421 0.3969884 (0.3285420945,0.3969883641] -2.681706          0</span></span>
<span><span class="co">##    sex age cause</span></span>
<span><span class="co">## 1 Male  60     1</span></span>
<span><span class="co">## 2 Male  60     1</span></span>
<span><span class="co">## 3 Male  60     1</span></span>
<span><span class="co">## 4 Male  60     1</span></span>
<span><span class="co">## 5 Male  60     1</span></span>
<span><span class="co">## 6 Male  60     1</span></span></code></pre>
<p>Model for cause specific hazards with shared effects is performed by
inclusion of interaction effects:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pam_csh_shared</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pamm.html">pamm</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">ped_status</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">tend</span>, by <span class="op">=</span> <span class="va">cause</span><span class="op">)</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">sex</span><span class="op">:</span><span class="va">cause</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">age</span><span class="op">:</span><span class="va">cause</span>,</span>
<span>  data <span class="op">=</span> <span class="va">ped_stacked</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pam_csh_shared</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Family: poisson </span></span>
<span><span class="co">## Link function: log </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Formula:</span></span>
<span><span class="co">## ped_status ~ s(tend, by = cause) + sex + sex:cause + age + age:cause</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parametric coefficients:</span></span>
<span><span class="co">##                  Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)      -3.17558    0.58527  -5.426 5.77e-08 ***</span></span>
<span><span class="co">## sexMale          -0.13712    0.13226  -1.037 0.299858    </span></span>
<span><span class="co">## age               0.02013    0.00847   2.376 0.017487 *  </span></span>
<span><span class="co">## sexFemale:cause2 -3.77440    1.05884  -3.565 0.000364 ***</span></span>
<span><span class="co">## sexMale:cause2   -3.46889    1.01238  -3.426 0.000611 ***</span></span>
<span><span class="co">## age:cause2        0.04402    0.01505   2.926 0.003439 ** </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Approximate significance of smooth terms:</span></span>
<span><span class="co">##                  edf Ref.df Chi.sq p-value   </span></span>
<span><span class="co">## s(tend):cause1 1.001  1.002  7.333 0.00680 **</span></span>
<span><span class="co">## s(tend):cause2 1.026  1.051 10.095 0.00161 **</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## R-sq.(adj) =  -0.00658   Deviance explained = 2.01%</span></span>
<span><span class="co">## UBRE = -0.93015  Scale est. = 1         n = 59614</span></span></code></pre>
<p>The results indicate that cause specific terms (interactions) are
necessary in this case and the two models largely agree. For example,
the age effect for the two causes are very similar for both models:</p>
<ul>
<li>cause1: 0.02 (<code>pamm_csh1</code>) vs. 0.02
(<code>pamm_csh_shared</code>)</li>
<li>cause2: 0.064 (<code>pamm_csh2</code>) vs. 0.02 + 0.044= 0.064
(<code>pamm_csh_shared</code>)</li>
</ul>
</div>
<div class="section level3">
<h3 id="cumulative-incidence-function-cif">Cumulative Incidence Function (CIF)<a class="anchor" aria-label="anchor" href="#cumulative-incidence-function-cif"></a>
</h3>
<p>Finally, in many cases we will want to calculate and visualize the
cumulative incidence functions for different covariate combinations. In
<strong><code>pammtools</code></strong> this can be again achieved using
<code>make_newdata</code> and using the appropriate <code>add_*</code>
function, here <code>add_cif</code>:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndf</span> <span class="op">&lt;-</span> <span class="va">ped_stacked</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/newdata.html">make_newdata</a></span><span class="op">(</span>tend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>, cause <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_cif.html">add_cif</a></span><span class="op">(</span><span class="va">pam_csh_shared</span><span class="op">)</span></span>
<span><span class="va">ndf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">tend</span>, <span class="va">cause</span>, <span class="va">cif</span>, <span class="va">cif_lower</span>, <span class="va">cif_upper</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   cause [2]</span></span></span>
<span><span class="co">##    tend cause     cif cif_lower cif_upper</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> 0.192 1     0.020<span style="text-decoration: underline;">2</span>    0.016<span style="text-decoration: underline;">1</span>     0.025<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> 0.274 1     0.028<span style="text-decoration: underline;">9</span>    0.023<span style="text-decoration: underline;">0</span>     0.036<span style="text-decoration: underline;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> 0.312 1     0.032<span style="text-decoration: underline;">9</span>    0.026<span style="text-decoration: underline;">3</span>     0.041<span style="text-decoration: underline;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> 0.192 2     0.009<span style="text-decoration: underline;">73</span>   0.006<span style="text-decoration: underline;">81</span>    0.013<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> 0.274 2     0.013<span style="text-decoration: underline;">9</span>    0.009<span style="text-decoration: underline;">77</span>    0.019<span style="text-decoration: underline;">9</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> 0.312 2     0.015<span style="text-decoration: underline;">9</span>    0.011<span style="text-decoration: underline;">2</span>     0.022<span style="text-decoration: underline;">6</span></span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ndf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tend</span>, y <span class="op">=</span> <span class="va">cif</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">cause</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">cif_lower</span>, ymax <span class="op">=</span> <span class="va">cif_upper</span>, fill <span class="op">=</span> <span class="va">cause</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span></span></code></pre></div>
<p><img src="competing-risks_files/figure-html/unnamed-chunk-8-1.png" width="500px" style="display: block; margin: auto;"></p>
<p>Similar to other applications of <code>add_*</code> functions, we can
additionally group by other covariate values:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ndf</span> <span class="op">&lt;-</span> <span class="va">ped_stacked</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/newdata.html">make_newdata</a></span><span class="op">(</span>tend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span>, cause <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">cause</span><span class="op">)</span>, sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ndf</span> <span class="op">&lt;-</span> <span class="va">ndf</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">cause</span>, <span class="va">sex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/add_cif.html">add_cif</a></span><span class="op">(</span><span class="va">pam_csh_shared</span><span class="op">)</span></span></code></pre></div>
<p>The estimated CIFs can then be compared w.r.t. to <code>cause</code>
for each category of <code>sex</code>:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ndf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tend</span>, y <span class="op">=</span> <span class="va">cif</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">cause</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">cif_lower</span>, ymax <span class="op">=</span> <span class="va">cif_upper</span>, fill <span class="op">=</span> <span class="va">cause</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sex</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span></code></pre></div>
<p><img src="competing-risks_files/figure-html/unnamed-chunk-10-1.png" width="700px" style="display: block; margin: auto;"></p>
<p>or w.r.t. to <code>sex</code> for each cause:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ndf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tend</span>, y <span class="op">=</span> <span class="va">cif</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">cif_lower</span>, ymax <span class="op">=</span> <span class="va">cif_upper</span>, fill <span class="op">=</span> <span class="va">sex</span><span class="op">)</span>,</span>
<span>    alpha <span class="op">=</span> <span class="fl">.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">cause</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span></span></code></pre></div>
<p><img src="competing-risks_files/figure-html/unnamed-chunk-11-1.png" width="700px" style="display: block; margin: auto;"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andreas Bender, Fabian Scheipl, Philipp Kopper.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c3726dcbf089f0b26f496305ed030c22',
    indexName: 'pammtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
