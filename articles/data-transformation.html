<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Transformation • pammtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Data Transformation">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44545040-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44545040-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pammtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.01</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-transformation.html">Data transformation</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Estimating the baseline hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic modeling</a>
    </li>
    <li>
      <a href="../articles/splines.html">Non-linear effects (penalized splines)</a>
    </li>
    <li>
      <a href="../articles/convenience.html">Workflow and convenience functions</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified models</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects (TVEs)</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailties (random effects)</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates (TDCs)</a>
    </li>
    <li>
      <a href="../articles/left-truncation.html">Left-truncated data</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/cumulative-effects.html">Cumulative effects/Exposure-Lag-Response Associations</a>
    </li>
    <li>
      <a href="../articles/competing-risks.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent Events</a>
    </li>
    <li>
      <a href="../articles/multi-state.html">Multi-State Modelling</a>
    </li>
    <li>
      <a href="../articles/smj-tutorial.html">Paper: A generalized additive model approach to time-to-event analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/pammtools" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>

    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Data Transformation</h1>
            
            <h4 data-toc-skip class="date">2025-03-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/pammtools/blob/master/vignettes/data-transformation.Rmd" class="external-link"><code>vignettes/data-transformation.Rmd</code></a></small>
      <div class="hidden name"><code>data-transformation.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/">pammtools</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette we provide details on transforming data into a
format suitable to fit piece-wise exponential (additive) models (PAM).
Three main cases need to be distinguished</p>
<ol style="list-style-type: decimal">
<li><p><a href="data-transformation.html#standard-time-to-event-data">Data without
time-dependent covariates</a></p></li>
<li><p><a href="data-transformation.html#left-truncated-data">Left-truncated
data</a></p></li>
<li><p><a href="data-transformation.html#data-with-time-dependent-covariates">Data
with time-dependent covariates</a></p></li>
<li><p><a href="data-transformation.html#data-with-time-dependent-covariates-with-cumulative-effects">Data
with time-dependent covariates that should be modeled as cumulative
effects</a></p></li>
</ol>
<div class="section level2">
<h2 id="standard-time-to-event-data">Standard time-to-event data<a class="anchor" aria-label="anchor" href="#standard-time-to-event-data"></a>
</h2>
<p>In the case of “standard” time-to-event the data, the transformation
is relatively straight forward and handled by the <code>as_ped</code>
(<strong>as</strong> <strong>p</strong>iece-wise
<strong>e</strong>xponential <strong>d</strong>ata) function. This
function internally calls <code><a href="https://rdrr.io/pkg/survival/man/survSplit.html" class="external-link">survival::survSplit</a></code>, thus all
arguments available for the <code>survSplit</code> function are also
available to the <code>as_ped</code> function.</p>
<div class="section level3">
<h3 id="using-defaults">Using defaults<a class="anchor" aria-label="anchor" href="#using-defaults"></a>
</h3>
<p>As an example data set we first consider a data set of a stomach area
tumor available from the <strong><code>pammtools</code></strong>
package. Patients were operated on to remove the tumor. Some patients
experienced complications during the operation:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"tumor"</span><span class="op">)</span></span>
<span><span class="va">tumor</span> <span class="op">&lt;-</span> <span class="va">tumor</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">tumor</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 10</span></span></span>
<span><span class="co">##      id  days status charlson_score   age sex    transfusion complications</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1   579      0              2    58 female yes         no           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2  <span style="text-decoration: underline;">1</span>192      0              2    52 male   no          yes          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3   308      1              2    74 female yes         no           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4    33      1              2    57 male   yes         yes          </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>     5   397      1              2    30 female yes         no           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>     6  <span style="text-decoration: underline;">1</span>219      0              2    66 female yes         no           </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: metastases &lt;fct&gt;, resection &lt;fct&gt;</span></span></span></code></pre>
<p>Each row contains information on the survival time
(<code>days</code>), an event indicator (<code>status</code>) as well as
information about comorbidities (<code>charlson_score</code>),
<code>age</code>, <code>sex</code>, and covariates that might be
relevant like whether or not complications occurred
(<code>complications</code>) and whether the cancer metastasized
(<code>metastases</code>).</p>
<p>To transform the data into piece-wise exponential data
(<code>ped</code>) format, we need to</p>
<ul>
<li><p>define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>+</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">J+1</annotation></semantics></math>
interval break points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mo>min</mo></msub><mo>=</mo><msub><mi>κ</mi><mn>0</mn></msub><mo>&lt;</mo><msub><mi>κ</mi><mn>1</mn></msub><mo>&lt;</mo><mi>⋯</mi><mo>&lt;</mo><msub><mi>κ</mi><mi>J</mi></msub><mo>=</mo><msub><mi>t</mi><mo>max</mo></msub></mrow><annotation encoding="application/x-tex">t_{\min} = \kappa_0 &lt; \kappa_1 &lt; \cdots &lt; \kappa_J = t_{\max}</annotation></semantics></math></p></li>
<li><p>create <em>pseudo</em>-observations for each interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>J</mi></mrow><annotation encoding="application/x-tex">j = 1,\ldots, J</annotation></semantics></math>
in which subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>,</mo><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">i, i = 1,\ldots,n</annotation></semantics></math>
was under risk.</p></li>
</ul>
<p>Using the <code>pammtools</code> package this is easily achieved with
the <code>as_ped</code> function as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tumor</span>, id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="va">ped</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">132</span>, <span class="fl">141</span>, <span class="fl">145</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tstart</span>, <span class="va">tend</span>, <span class="va">interval</span>, <span class="va">offset</span>, <span class="va">ped_status</span>, <span class="va">age</span>, <span class="va">sex</span>, <span class="va">complications</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     id tstart tend interval    offset ped_status age  sex complications</span></span>
<span><span class="co">## 1  132      0    1    (0,1] 0.0000000          0  78 male           yes</span></span>
<span><span class="co">## 2  132      1    2    (1,2] 0.0000000          0  78 male           yes</span></span>
<span><span class="co">## 3  132      2    3    (2,3] 0.0000000          0  78 male           yes</span></span>
<span><span class="co">## 4  132      3    5    (3,5] 0.6931472          1  78 male           yes</span></span>
<span><span class="co">## 5  141      0    1    (0,1] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 6  141      1    2    (1,2] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 7  141      2    3    (2,3] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 8  141      3    5    (3,5] 0.6931472          0  79 male           yes</span></span>
<span><span class="co">## 9  141      5    6    (5,6] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 10 141      6    7    (6,7] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 11 141      7    8    (7,8] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 12 141      8   10   (8,10] 0.6931472          0  79 male           yes</span></span>
<span><span class="co">## 13 141     10   11  (10,11] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 14 141     11   12  (11,12] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 15 141     12   13  (12,13] 0.0000000          0  79 male           yes</span></span>
<span><span class="co">## 16 141     13   14  (13,14] 0.0000000          1  79 male           yes</span></span>
<span><span class="co">## 17 145      0    1    (0,1] 0.0000000          0  60 male           yes</span></span>
<span><span class="co">## 18 145      1    2    (1,2] 0.0000000          0  60 male           yes</span></span>
<span><span class="co">## 19 145      2    3    (2,3] 0.0000000          0  60 male           yes</span></span>
<span><span class="co">## 20 145      3    5    (3,5] 0.6931472          0  60 male           yes</span></span>
<span><span class="co">## 21 145      5    6    (5,6] 0.0000000          0  60 male           yes</span></span>
<span><span class="co">## 22 145      6    7    (6,7] 0.0000000          0  60 male           yes</span></span>
<span><span class="co">## 23 145      7    8    (7,8] 0.0000000          1  60 male           yes</span></span></code></pre>
<p>When no cut points are specified, the default is to use the unique
event times. As can be seen from the above output, the function creates
an <code>id</code> variable, indicating the subjects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>i</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>n</mi></mrow><annotation encoding="application/x-tex">i = 1,\ldots,n</annotation></semantics></math>,
with one row per interval that the subject “visited”. Thus,</p>
<ul>
<li>subject <code>132</code> was at risk during 4 intervals,</li>
<li>subject <code>141</code> was at risk during 12 intervals,</li>
<li>and subject <code>145</code> in 7 intervals.</li>
</ul>
<p>In addition to the optional <code>id</code> variable the function
also creates</p>
<ul>
<li>
<code>tstart</code>: the beginning of each interval</li>
<li>
<code>tend</code>: the end of each interval</li>
<li>
<code>interval</code>: a factor variable denoting the interval</li>
<li>
<code>offset</code>: the log of the duration during which the
subject was under risk in that interval</li>
</ul>
<p>Additionally the time-constant covariates (here: <code>age</code>,
<code>sex</code>, <code>complications</code>,) are repeated
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>i</mi></msub><annotation encoding="application/x-tex">n_i</annotation></semantics></math>
number of times, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>i</mi></msub><annotation encoding="application/x-tex">n_i</annotation></semantics></math>
is the number of intervals during which subject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
was in the risk set.</p>
</div>
<div class="section level3">
<h3 id="custom-cut-points">Custom cut points<a class="anchor" aria-label="anchor" href="#custom-cut-points"></a>
</h3>
<p>Per default, the <code>as_ped</code> function uses all unique event
times as cut points (which is a sensible default as for example the
(cumulative) baseline hazard estimates in Cox-PH functions are also
updated at event times). Also, PAMMs represent the baseline hazard via
splines whose basis functions are evaluated at the cut points. Using
unique events times automatically increases the density of cut points in
relevant areas of the follow-up.</p>
<p>In some cases, however, one might want to reduce the number of cut
points, to reduce the size of the resulting data and/or faster
estimation times. To do so the <code>cut</code> argument has to be
specified. Following the above example, we can use only 4 cut points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>κ</mi><mn>0</mn></msub><mo>=</mo><mn>0</mn><mo>,</mo><msub><mi>κ</mi><mn>1</mn></msub><mo>=</mo><mn>3</mn><mo>,</mo><msub><mi>κ</mi><mn>2</mn></msub><mo>=</mo><mn>7</mn><mo>,</mo><msub><mi>κ</mi><mn>3</mn></msub><mo>=</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">\kappa_0 = 0, \kappa_1 = 3, \kappa_2 = 7, \kappa_3 = 15</annotation></semantics></math>,
resulting in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">J = 3</annotation></semantics></math>
intervals:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">days</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">tumor</span>, cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">15</span><span class="op">)</span>, id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="va">ped2</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">132</span>, <span class="fl">141</span>, <span class="fl">145</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tstart</span>, <span class="va">tend</span>, <span class="va">interval</span>, <span class="va">offset</span>, <span class="va">ped_status</span>, <span class="va">age</span>, <span class="va">sex</span>, <span class="va">complications</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id tstart tend interval    offset ped_status age  sex complications</span></span>
<span><span class="co">## 1 132      0    3    (0,3] 1.0986123          0  78 male           yes</span></span>
<span><span class="co">## 2 132      3    7    (3,7] 0.6931472          1  78 male           yes</span></span>
<span><span class="co">## 3 141      0    3    (0,3] 1.0986123          0  79 male           yes</span></span>
<span><span class="co">## 4 141      3    7    (3,7] 1.3862944          0  79 male           yes</span></span>
<span><span class="co">## 5 141      7   15   (7,15] 1.9459101          1  79 male           yes</span></span>
<span><span class="co">## 6 145      0    3    (0,3] 1.0986123          0  60 male           yes</span></span>
<span><span class="co">## 7 145      3    7    (3,7] 1.3862944          0  60 male           yes</span></span>
<span><span class="co">## 8 145      7   15   (7,15] 0.0000000          1  60 male           yes</span></span></code></pre>
<p>Note that now subjects <code>141</code> and <code>145</code> have
both three rows in the data set. The fact that subject <code>141</code>
was in the risk set of the last interval for a longer time than subject
<code>145</code> is, however, still accounted for by the
<code>offset</code> variable. Note that the <code>offset</code> for
subject <code>145</code> is only <code>0</code>, because the last
interval for this subject starts at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">t=7</annotation></semantics></math>
and the subject experienced and event at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">t=8</annotation></semantics></math>,
thus
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>8</mn><mo>−</mo><mn>7</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\log(8-7) = 0</annotation></semantics></math></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tumor</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">85</span>, <span class="fl">112</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 10</span></span></span>
<span><span class="co">##      id  days status charlson_score   age sex    transfusion complications</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>        </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>    85   126      1              2    64 female yes         no           </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>   112   888      0              5    71 male   yes         no           </span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 2 more variables: metastases &lt;fct&gt;, resection &lt;fct&gt;</span></span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="left-truncated-data">Left-truncated Data<a class="anchor" aria-label="anchor" href="#left-truncated-data"></a>
</h2>
<p>In left truncated data, subjects enter the risk set at some
time-point unequal to zero. Such data usually ships in the so called
start-stop notation, where for each subject the start time specifies the
left-truncation time (can also be 0) and the stop time the
time-to-event, which can be right-censored.</p>
<p>For an illustration, we use a data set on infant mortality and
maternal death available in the <strong><code>eha</code></strong>
package (see <code><a href="https://ehar.se/r/eha/reference/infants.html" class="external-link">?eha::infants</a></code>) for details.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">infants</span>, package <span class="op">=</span> <span class="st">"eha"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">infants</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   stratum enter exit event mother age  sex      parish   civst    ses year</span></span>
<span><span class="co">## 1       1    55  365     0   dead  26  boy Nedertornea married farmer 1877</span></span>
<span><span class="co">## 2       1    55  365     0  alive  26  boy Nedertornea married farmer 1870</span></span>
<span><span class="co">## 3       1    55  365     0  alive  26  boy Nedertornea married farmer 1882</span></span>
<span><span class="co">## 4       2    13   76     1   dead  23 girl Nedertornea married  other 1847</span></span>
<span><span class="co">## 5       2    13  365     0  alive  23 girl Nedertornea married  other 1847</span></span>
<span><span class="co">## 6       2    13  365     0  alive  23 girl Nedertornea married  other 1848</span></span></code></pre>
<p>As children were included in the study after death of their mother,
their survival time is left-truncated at the entry time (variable
<code>enter</code>). When transforming such data to the PED format, we
need to create a interval cut-point at each entry time. In general, each
interval has to be constructed such that only subjects already at risk
have an entry in the PED data. The previously introduced function
<code>as_ped</code> can be also used for this setting, however, the LHS
of the formula must be in start-stop format:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">infants_ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">enter</span>, <span class="va">exit</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">mother</span> <span class="op">+</span> <span class="va">age</span>, data <span class="op">=</span> <span class="va">infants</span><span class="op">)</span></span>
<span><span class="va">infants_ped</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    id tstart tend interval    offset ped_status mother age</span></span>
<span><span class="co">## 1   4     13   14  (13,14] 0.0000000          0   dead  23</span></span>
<span><span class="co">## 2   4     14   16  (14,16] 0.6931472          0   dead  23</span></span>
<span><span class="co">## 3   4     16   17  (16,17] 0.0000000          0   dead  23</span></span>
<span><span class="co">## 4   4     17   18  (17,18] 0.0000000          0   dead  23</span></span>
<span><span class="co">## 5   4     18   22  (18,22] 1.3862944          0   dead  23</span></span>
<span><span class="co">## 6   4     22   24  (22,24] 0.6931472          0   dead  23</span></span>
<span><span class="co">## 7   4     24   28  (24,28] 1.3862944          0   dead  23</span></span>
<span><span class="co">## 8   4     28   29  (28,29] 0.0000000          0   dead  23</span></span>
<span><span class="co">## 9   4     29   30  (29,30] 0.0000000          0   dead  23</span></span>
<span><span class="co">## 10  4     30   31  (30,31] 0.0000000          0   dead  23</span></span>
<span><span class="co">## 11  4     31   36  (31,36] 1.6094379          0   dead  23</span></span>
<span><span class="co">## 12  4     36   39  (36,39] 1.0986123          0   dead  23</span></span>
<span><span class="co">## 13  4     39   44  (39,44] 1.6094379          0   dead  23</span></span>
<span><span class="co">## 14  4     44   53  (44,53] 2.1972246          0   dead  23</span></span>
<span><span class="co">## 15  4     53   55  (53,55] 0.6931472          0   dead  23</span></span>
<span><span class="co">## 16  4     55   62  (55,62] 1.9459101          0   dead  23</span></span>
<span><span class="co">## 17  4     62   76  (62,76] 2.6390573          1   dead  23</span></span></code></pre>
<p>For analysis of such data refer to the <a href="left-truncation.html">Left-truncation vignette</a></p>
</div>
<div class="section level2">
<h2 id="data-with-time-dependent-covariates">Data with time-dependent covariates<a class="anchor" aria-label="anchor" href="#data-with-time-dependent-covariates"></a>
</h2>
<p>In case of data with time-dependent covariates (that should not be
modeled as cumulative effects), the follow-up is usually split at
desired cut-points and <em>additionally</em> at the time-points at which
the TDC changes its value.</p>
<p>We assume that the data is provided in two data sets, one that
contains time-to-event data and time-constant covariates and one data
set that contains information of time-dependent covariates.</p>
<p>For illustration, we use the <code>pbc</code> data from the
<code>survival</code> package. Before the actual data transformation we
perform the data preprocessing in
<code><a href="https://cran.rstudio.com/web/packages/survival/vignettes/timedep.pdf" class="external-link">vignette("timedep", package="survival")</a></code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"pbc"</span>, package <span class="op">=</span> <span class="st">"survival"</span><span class="op">)</span> <span class="co"># loads pbc and pbcseq</span></span>
<span><span class="va">pbc</span> <span class="op">&lt;-</span> <span class="va">pbc</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">id</span> <span class="op">&lt;=</span> <span class="fl">312</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>status <span class="op">=</span> <span class="fl">1L</span> <span class="op">*</span> <span class="op">(</span><span class="va">status</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">id</span><span class="op">:</span><span class="va">sex</span>, <span class="va">bili</span>, <span class="va">protime</span><span class="op">)</span></span></code></pre></div>
<p>We want to transform the data such that we could fit a concurrent
effect of the time-dependent covariates <code>bili</code> and
<code>protime</code>, therefore, the RHS of the formula passed to
<code>as_ped</code> needs to contain an additional component, separated
by <code>|</code> and all variables for which should be transformed to
the concurrent format specified within the <code>concurrent</code>
special. The data sets are provided within a list. In
<code>concurrent</code>, we also have to specify the name of the
variable which stores information on the time points at which the TDCs
are updated.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped_pbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span></span>
<span>  data    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pbc</span>, <span class="va">pbcseq</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="../reference/specials.html">concurrent</a></span><span class="op">(</span><span class="va">bili</span>, <span class="va">protime</span>, tz_var <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span>,</span>
<span>  id      <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<p>Multiple data sets can be provided within the list and multiple
<code>concurrent</code> terms with different <code>tz_var</code>
arguments can be specified with different lags. This will increase the
data set, as an (additional) split point will be generated for each
(lagged) time-point at which the TDC was observed:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pbc_ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">pbc</span>, <span class="va">pbcseq</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="../reference/specials.html">concurrent</a></span><span class="op">(</span><span class="va">bili</span>, tz_var <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/specials.html">concurrent</a></span><span class="op">(</span><span class="va">protime</span>, tz_var <span class="op">=</span> <span class="st">"day"</span>, lag <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
<p>If different <code>tz_var</code> arguments are provided, the union of
both will be used as cut points in addition to usual cut points.</p>
<p><strong>Warning</strong>: For time-points on the follow up that have
no observation of the TDC, the last observation will be carried forward
until the next update is available.</p>
</div>
<div class="section level2">
<h2 id="data-with-time-dependent-covariates-with-cumulative-effects">Data with time-dependent covariates (with cumulative effects)<a class="anchor" aria-label="anchor" href="#data-with-time-dependent-covariates-with-cumulative-effects"></a>
</h2>
<p>Here we demonstrate data transformation of data with TDCs
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝐳</mi><mo>=</mo><mo stretchy="false" form="prefix">{</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mrow><mi>z</mi><mo>,</mo><mi>q</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>q</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>Q</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathbf{z}=\{z(t_{z,q}),q=1,\ldots,Q\}</annotation></semantics></math>,
that subsequently will be modeled as cumulative effects defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐳</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>∫</mo><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi mathvariant="normal">d</mi><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">
g(\mathbf{z}, t) = \int_{\mathcal{T}(t)} h(t, t_z, z(t_z))\mathrm{d}t_z
</annotation></semantics></math> Here</p>
<ul>
<li>
<p>the three-variate function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t,t_z,z(t_z))</annotation></semantics></math>
defines the so-called <em>partial effects</em> of the TDC
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(t_z)</annotation></semantics></math>
observed at exposure time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
on the hazard at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math><span class="citation">(Bender et al. 2018)</span>. The general partial
effect definition given above is only one possibility, other common
choices are<br> </p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z)z(t_z)</annotation></semantics></math>
(This is the WCE model by <span class="citation">Sylvestre and
Abrahamowicz (2009)</span>) <br> </li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z, z(t_z))</annotation></semantics></math>
(This is the DLNM model by <span class="citation">Gasparrini et al.
(2017)</span>)<br> </li>
</ul>
</li>
<li><p>the cumulative effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝐳</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{z}, t)</annotation></semantics></math>
at follow-up time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
is the integral (or sum) of the partial effects over exposure times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
contained within
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math><br> </p></li>
<li><p>the so called lag-lead window (or window of effectiveness) is
denoted by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math>.
This represents the set of exposure times at which exposures can affect
the hazard rate at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>.
The most common definition is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>t</mi><mrow><mi>z</mi><mo>,</mo><mi>q</mi></mrow></msub><mo>:</mo><mi>t</mi><mo>≥</mo><msub><mi>t</mi><mrow><mi>z</mi><mo>,</mo><mi>q</mi></mrow></msub><mo>,</mo><mi>q</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>Q</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{T}(t) = \{t_{z,q}: t \geq t_{z,q}, q=1,\ldots, Q\}</annotation></semantics></math>,
which means that all exposures that were observed prior to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
or at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
are eligible.</p></li>
</ul>
<p>As before we use the function <code>as_ped</code> to transform the
data and additionally use the formula special <code>cumulative</code>
(for <strong>fun</strong>ctional <strong>c</strong>ovariate) to specify
the partial effect structure on the right-hand side of the formula.</p>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
(<code>time</code>) the follow up time,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_1</annotation></semantics></math>
(<code>z1</code>) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_2</annotation></semantics></math>
(<code>z2</code>) two TDCs observed at different exposure time grids
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
(<code>tz1</code>) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>z</mi></msub><annotation encoding="application/x-tex">s_z</annotation></semantics></math>
(<code>tz2</code>) with lag-lead windows
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝒯</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>t</mi><mrow><mi>z</mi><mo>,</mo><mi>q</mi></mrow></msub><mo>:</mo><mi>t</mi><mo>≥</mo><msub><mi>t</mi><mrow><mi>z</mi><mo>,</mo><mi>q</mi></mrow></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{T}_1(t) = \{t_{z,q}: t \geq t_{z,q}\}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝒯</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>s</mi><mrow><mi>z</mi><mo>,</mo><mi>k</mi></mrow></msub><mo>:</mo><mi>t</mi><mo>≥</mo><msub><mi>s</mi><mrow><mi>z</mi><mo>,</mo><mi>k</mi></mrow></msub><mo>+</mo><mn>2</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{T}_2(t) = \{s_{z,k}: t \geq s_{z,k} + 2\}</annotation></semantics></math>
(defined by
<code>ll2 &lt;- function(t, tz) { t &gt;= tz + 2}</code>).</p>
<p>The table below gives a selection of possible partial effects and the
usage of <code>cumulative</code> to create matrices needed to estimate
different types of cumulative effects of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_2</annotation></semantics></math>:</p>
<table class="table">
<colgroup>
<col width="49%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>partial effect</th>
<th>
<code>as_ped</code> specification</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∫</mo><msub><mi>𝒯</mi><mn>1</mn></msub></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\int_{\mathcal{T}_1}h(t-t_z, z_1(t_z))</annotation></semantics></math></td>
<td><code>cumulative(latency(tz1), z1, tz_var= "tz1")</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∫</mo><msub><mi>𝒯</mi><mn>1</mn></msub></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\int_{\mathcal{T}_1}h(t, t-t_z, z_1(t_z))</annotation></semantics></math></td>
<td><code>cumulative(time, latency(tz1), z1, tz_var="tz1")</code></td>
</tr>
<tr class="odd">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∫</mo><msub><mi>𝒯</mi><mn>1</mn></msub></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\int_{\mathcal{T}_1}h(t, t_z, z_1(t_z))</annotation></semantics></math></td>
<td><code>cumulative(time, tz1, z1, tz_var="tz1")</code></td>
</tr>
<tr class="even">
<td><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∫</mo><msub><mi>𝒯</mi><mn>1</mn></msub></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mo>∫</mo><msub><mi>𝒯</mi><mn>2</mn></msub></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>s</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\int_{\mathcal{T}_1}h(t, t_z, z_1(t_z)) + \int_{\mathcal{T}_2}h(t-s_z, z_2(s_z))</annotation></semantics></math></td>
<td><code>cumulative(time, tz1, z1, tz_var="tz1") + cumulative(latency(tz2), z2, tz_var="tz2", ll_fun=ll2)</code></td>
</tr>
<tr class="odd">
<td>…</td>
<td>…</td>
</tr>
</tbody>
</table>
<p>Note that</p>
<ul>
<li><p>the variable representing follow-up time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
in <code>cumulative</code> (here <code>time</code>) must match the time
variable specified on the left-hand side of the
<code>formula</code></p></li>
<li><p>the variable representing exposure time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
(here <code>tz1</code> and <code>tz2</code>) must be wrapped within
<code>latency()</code> to tell <code>as_ped</code> to calculate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">t-t_z</annotation></semantics></math></p></li>
<li><p>by default,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math>
is defined as <code>function(t, tz) {t &gt;= tz}</code>, thus for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝒯</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathcal{T}_1</annotation></semantics></math>
it is not necessary to explicitly specify the lag-lead window. In case
you want to use a custom lag-lead window, provide the respective
function to the <code>ll_fun</code> argument in <code>cumulative</code>
(see <code>ll2</code> in the examples above)</p></li>
<li><p><code>cumulative</code> makes no difference between partial
effects such as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z, z(t_z))</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z)z(t_z)</annotation></semantics></math>
as the necessary data transformation is the same in both cases. Later,
however, when fitting the model, a distinction must be made</p></li>
<li><p>more than one
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
variable can be provided to <code>cumulative</code>, which can be
convenient if multiple covariates should have the same time components
and the same lag-lead window</p></li>
<li><p>multiple <code>cumulative</code> terms can be specified, having
different exposure times <code>t_z</code>, <code>s_z</code> and/or
different lag-lead windows for different covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_1</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_2</annotation></semantics></math></p></li>
<li><p>To tell <code>cumulative</code> which of the variables specified
is the exposure time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>,
the <code>tz_var</code> argument must be specified within each
<code>cumulative</code> term. The follow-up time component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
will be automatically recognized via the left-hand side of the
<code>formula</code>.</p></li>
</ul>
<div class="section level3">
<h3 id="one-time-dependent-covariate">One time-dependent covariate<a class="anchor" aria-label="anchor" href="#one-time-dependent-covariate"></a>
</h3>
<p>For illustration we use the ICU patients data sets
<code>patient</code> and <code>daily</code> provided in the
<strong><code>pammtools</code></strong> package, with follow-up time
<code>survhosp</code>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>),
exposure time <code>Study_Day</code>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>)
and TDCs <code>caloriesPercentage</code>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_1</annotation></semantics></math>
and <code>proteinGproKG</code>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_2</annotation></semantics></math>):</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">patient</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Year CombinedicuID CombinedID Survdays PatientDied survhosp Gender Age</span></span>
<span><span class="co">## 1 2007          1114       1110     30.1           0     30.1   Male  68</span></span>
<span><span class="co">## 2 2007          1114       1111     30.1           0     30.1 Female  57</span></span>
<span><span class="co">## 3 2007          1114       1116      9.8           1      9.8 Female  68</span></span>
<span><span class="co">## 4 2007           598       1316     30.1           0     30.1   Male  47</span></span>
<span><span class="co">## 5 2007           365       1410     30.1           0     30.1   Male  69</span></span>
<span><span class="co">## 6 2007           365       1414     30.1           0      5.4   Male  47</span></span>
<span><span class="co">##            AdmCatID ApacheIIScore      BMI           DiagID2</span></span>
<span><span class="co">## 1 Surgical Elective            20 31.60321   Cardio-Vascular</span></span>
<span><span class="co">## 2           Medical            22 24.34176       Respiratory</span></span>
<span><span class="co">## 3 Surgical Elective            25 17.99308   Cardio-Vascular</span></span>
<span><span class="co">## 4           Medical            16 33.74653 Orthopedic/Trauma</span></span>
<span><span class="co">## 5 Surgical Elective            20 38.75433       Respiratory</span></span>
<span><span class="co">## 6           Medical            21 45.00622       Respiratory</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">daily</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">##   CombinedID Study_Day caloriesPercentage proteinGproKG</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>       <span style="text-decoration: underline;">1</span>110         1               0            0    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>       <span style="text-decoration: underline;">1</span>110         2               0            0    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>       <span style="text-decoration: underline;">1</span>110         3               4.05         0    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>       <span style="text-decoration: underline;">1</span>110         4              35.1          0.259</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span>       <span style="text-decoration: underline;">1</span>110         5              77.2          0.647</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span>       <span style="text-decoration: underline;">1</span>110         6              17.3          0</span></span></code></pre>
<p>Below we illustrate the usage of <code>as_ped</code> and
<code>cumulative</code> to obtain covariate matrices for the latency
matrix of follow up time and exposure time and a matrix of the TDC
(<code>caloriesPercentage</code>). The follow up will be split in 30
intervals with interval breaks points <code>0:30</code>. By default, the
exposure time provided to <code>tz_var</code> will be used as a suffix
for the names of the new matrix columns to indicate the exposure they
refer to, however, you can override the suffix by specifying the
<code>suffix</code> argument to <code>cumulative</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span></span>
<span>  data    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">daily</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">survhosp</span>, <span class="va">PatientDied</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/specials.html">cumulative</a></span><span class="op">(</span><span class="fu">latency</span><span class="op">(</span><span class="va">Study_Day</span><span class="op">)</span>, <span class="va">caloriesPercentage</span>, tz_var <span class="op">=</span> <span class="st">"Study_Day"</span><span class="op">)</span>,</span>
<span>  cut     <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"CombinedID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ped</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Classes 'fped', 'ped' and 'data.frame':  37258 obs. of  18 variables:</span></span>
<span><span class="co">##  $ CombinedID        : int  1110 1110 1110 1110 1110 1110 1110 1110 1110 1110 ...</span></span>
<span><span class="co">##  $ tstart            : num  0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">##  $ tend              : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ interval          : Factor w/ 30 levels "(0,1]","(1,2]",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ offset            : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ ped_status        : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ Year              : Factor w/ 4 levels "2007","2008",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ CombinedicuID     : Factor w/ 456 levels "21","24","25",..: 355 355 355 355 355 355 355 355 355 355 ...</span></span>
<span><span class="co">##  $ Survdays          : num  30.1 30.1 30.1 30.1 30.1 30.1 30.1 30.1 30.1 30.1 ...</span></span>
<span><span class="co">##  $ Gender            : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ Age               : int  68 68 68 68 68 68 68 68 68 68 ...</span></span>
<span><span class="co">##  $ AdmCatID          : Factor w/ 3 levels "Medical","Surgical Elective",..: 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ ApacheIIScore     : int  20 20 20 20 20 20 20 20 20 20 ...</span></span>
<span><span class="co">##  $ BMI               : num  31.6 31.6 31.6 31.6 31.6 ...</span></span>
<span><span class="co">##  $ DiagID2           : Factor w/ 9 levels "Gastrointestinal",..: 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ Study_Day_latency : num [1:37258, 1:12] 0 0 1 2 3 4 5 6 7 8 ...</span></span>
<span><span class="co">##  $ caloriesPercentage: num [1:37258, 1:12] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ LL                : num [1:37258, 1:12] 0 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  - attr(*, "breaks")= int [1:31] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">##  - attr(*, "id_var")= chr "CombinedID"</span></span>
<span><span class="co">##  - attr(*, "intvars")= chr [1:6] "CombinedID" "tstart" "tend" "interval" ...</span></span>
<span><span class="co">##  - attr(*, "trafo_args")=List of 3</span></span>
<span><span class="co">##  - attr(*, "time_var")= chr "survhosp"</span></span>
<span><span class="co">##  - attr(*, "status_var")= chr "PatientDied"</span></span>
<span><span class="co">##  - attr(*, "func")=List of 1</span></span>
<span><span class="co">##  - attr(*, "ll_funs")=List of 1</span></span>
<span><span class="co">##  - attr(*, "tz")=List of 1</span></span>
<span><span class="co">##  - attr(*, "tz_vars")=List of 1</span></span>
<span><span class="co">##  - attr(*, "ll_weights")=List of 1</span></span>
<span><span class="co">##  - attr(*, "func_mat_names")=List of 1</span></span></code></pre>
<p>As you can see, the data is transformed to the PED format as before
and two additional matrix columns are added,
<code>Study_Day_latency</code> and
<code>caloriesPercentage</code>.<br> </p>
</div>
<div class="section level3">
<h3 id="two-time-dependent-covariates-observed-on-the-same-exposure-time-grid">Two time-dependent covariates observed on the same exposure time
grid<a class="anchor" aria-label="anchor" href="#two-time-dependent-covariates-observed-on-the-same-exposure-time-grid"></a>
</h3>
<p>Using the same data, we show a slightly more complex example with two
functional covariate terms with partial effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t, t-t_z, z_1(t_z))</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z, z_2(t_z))</annotation></semantics></math>.
As in the case of ICU patient data, both TDCs were observed on the same
exposure time grid, we want to use the same lag-lead window and the
latency term
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">t-t_z</annotation></semantics></math>
occurs in both partial effects, we only need to specify one
<code>cumulative</code> term.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">patient</span>, <span class="va">daily</span><span class="op">)</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">survhosp</span>, <span class="va">PatientDied</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/specials.html">cumulative</a></span><span class="op">(</span><span class="va">survhosp</span>, <span class="fu">latency</span><span class="op">(</span><span class="va">Study_Day</span><span class="op">)</span>, <span class="va">caloriesPercentage</span>, <span class="va">proteinGproKG</span>,</span>
<span>      tz_var <span class="op">=</span> <span class="st">"Study_Day"</span><span class="op">)</span>,</span>
<span>  cut <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">30</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"CombinedID"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ped</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Classes 'fped', 'ped' and 'data.frame':  37258 obs. of  20 variables:</span></span>
<span><span class="co">##  $ CombinedID        : int  1110 1110 1110 1110 1110 1110 1110 1110 1110 1110 ...</span></span>
<span><span class="co">##  $ tstart            : num  0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">##  $ tend              : int  1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ interval          : Factor w/ 30 levels "(0,1]","(1,2]",..: 1 2 3 4 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ offset            : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ ped_status        : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ Year              : Factor w/ 4 levels "2007","2008",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ CombinedicuID     : Factor w/ 456 levels "21","24","25",..: 355 355 355 355 355 355 355 355 355 355 ...</span></span>
<span><span class="co">##  $ Survdays          : num  30.1 30.1 30.1 30.1 30.1 30.1 30.1 30.1 30.1 30.1 ...</span></span>
<span><span class="co">##  $ Gender            : Factor w/ 2 levels "Female","Male": 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ Age               : int  68 68 68 68 68 68 68 68 68 68 ...</span></span>
<span><span class="co">##  $ AdmCatID          : Factor w/ 3 levels "Medical","Surgical Elective",..: 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ ApacheIIScore     : int  20 20 20 20 20 20 20 20 20 20 ...</span></span>
<span><span class="co">##  $ BMI               : num  31.6 31.6 31.6 31.6 31.6 ...</span></span>
<span><span class="co">##  $ DiagID2           : Factor w/ 9 levels "Gastrointestinal",..: 2 2 2 2 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ survhosp_mat      : int [1:37258, 1:12] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">##  $ Study_Day_latency : num [1:37258, 1:12] 0 0 1 2 3 4 5 6 7 8 ...</span></span>
<span><span class="co">##  $ caloriesPercentage: num [1:37258, 1:12] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ proteinGproKG     : num [1:37258, 1:12] 0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ LL                : num [1:37258, 1:12] 0 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  - attr(*, "breaks")= int [1:31] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">##  - attr(*, "id_var")= chr "CombinedID"</span></span>
<span><span class="co">##  - attr(*, "intvars")= chr [1:6] "CombinedID" "tstart" "tend" "interval" ...</span></span>
<span><span class="co">##  - attr(*, "trafo_args")=List of 3</span></span>
<span><span class="co">##  - attr(*, "time_var")= chr "survhosp"</span></span>
<span><span class="co">##  - attr(*, "status_var")= chr "PatientDied"</span></span>
<span><span class="co">##  - attr(*, "func")=List of 1</span></span>
<span><span class="co">##  - attr(*, "ll_funs")=List of 1</span></span>
<span><span class="co">##  - attr(*, "tz")=List of 1</span></span>
<span><span class="co">##  - attr(*, "tz_vars")=List of 1</span></span>
<span><span class="co">##  - attr(*, "ll_weights")=List of 1</span></span>
<span><span class="co">##  - attr(*, "func_mat_names")=List of 1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="multiple-tdcs-observed-at-different-exposure-time-grids">Multiple TDCs observed at different exposure time grids<a class="anchor" aria-label="anchor" href="#multiple-tdcs-observed-at-different-exposure-time-grids"></a>
</h3>
<p>To illustrate data transformation when TDCs
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐳</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\mathbf{z}_2</annotation></semantics></math>
were observed on different exposure time grids
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>s</mi><mi>z</mi></msub><annotation encoding="application/x-tex">s_z</annotation></semantics></math>)
and are assumed to have different lag_lead windows
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝒯</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}_1(t)</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝒯</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}_2(t)</annotation></semantics></math>,
we use simulated data <code>simdf_elra</code> contained in
<strong><code>pammtools</code></strong> (see example in
<code>sim_pexp</code> for data generation).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdf_elra</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 250 × 9</span></span></span>
<span><span class="co">##       id   time status      x1    x2 tz1        z.tz1      tz2        z.tz2     </span></span>
<span><span class="co">##  <span style="color: #BCBCBC;">*</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>    </span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1  3.22       1  1.59   4.61  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     2 10          0 -<span style="color: #BB0000;">0.530</span>  0.178 <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     3  0.808      1 -<span style="color: #BB0000;">2.43</span>   3.25  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     4  3.04       1  0.696  1.26  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     5  3.36       1  2.54   3.71  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     6  4.07       1 -<span style="color: #BB0000;">0.023</span><span style="color: #BB0000; text-decoration: underline;">1</span> 0.607 <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     7  0.534      1  1.68   1.74  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     8  1.57       1 -<span style="color: #BB0000;">1.89</span>   2.51  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     9  2.39       1  0.126  3.38  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>    10  6.61       1  1.79   1.06  <span style="color: #949494;">&lt;int [10]&gt;</span> <span style="color: #949494;">&lt;dbl [10]&gt;</span> <span style="color: #949494;">&lt;int [11]&gt;</span> <span style="color: #949494;">&lt;dbl [11]&gt;</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 240 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdf_elra</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tz1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `cols` is now required when using `unnest()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `cols = c(tz1)`.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 10 × 2</span></span></span>
<span><span class="co">##       id   tz1</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     1     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     1     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     1     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     1     5</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     1     6</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     1     7</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     1     8</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     1     9</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     1    10</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdf_elra</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">id</span>, <span class="va">tz2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: `cols` is now required when using `unnest()`.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please use `cols = c(tz2)`.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 11 × 2</span></span></span>
<span><span class="co">##       id   tz2</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>     1    -<span style="color: #BB0000;">5</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>     1    -<span style="color: #BB0000;">4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>     1    -<span style="color: #BB0000;">3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>     1    -<span style="color: #BB0000;">2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>     1    -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>     1     0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>     1     1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>     1     2</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>     1     3</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>     1     4</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">11</span>     1     5</span></span></code></pre>
<p>Note that <code>tz1</code> has a maximum length of 10, while
<code>tz2</code> has a maximum length of <code>11</code> and while
<code>tz1</code> was observed during the follow up, <code>tz2</code> was
partially observed before the beginning of the follow up.</p>
<p>If we wanted to estimate the following cumulative effects</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐳</mi><mn>1</mn></msub><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>∫</mo><mrow><msub><mi>𝒯</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{z}_1, t) = \int_{\mathcal{T}_1(t)} h(t, t-t_z, z_1(s_z))</annotation></semantics></math>
and</li>
<li><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐳</mi><mn>2</mn></msub><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>∫</mo><mrow><msub><mi>𝒯</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><msub><mi>z</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>s</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\mathbf{z}_2, t) = \int_{\mathcal{T}_2(t)} h(t-t_z, z_2(s_z))</annotation></semantics></math></li>
</ul>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝒯</mi><mn>1</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>t</mi><mi>z</mi></msub><mo>:</mo><mi>t</mi><mo>≥</mo><msub><mi>t</mi><mi>z</mi></msub><mo>+</mo><mn>2</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{T}_1(t)  = \{t_z: t \geq t_z + 2\}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝒯</mi><mn>2</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>s</mi><mi>z</mi></msub><mo>:</mo><mi>t</mi><mo>≥</mo><msub><mi>s</mi><mi>z</mi></msub><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathcal{T}_2(t)  = \{s_z: t \geq s_z\}</annotation></semantics></math>
the data transformation function must reflect the different exposure
times as well as different lag-lead window specifications as illustrated
below:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ped_sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">simdf_elra</span>,</span>
<span>  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/specials.html">cumulative</a></span><span class="op">(</span><span class="va">time</span>, <span class="fu">latency</span><span class="op">(</span><span class="va">tz1</span><span class="op">)</span>, <span class="va">z.tz1</span>, tz_var <span class="op">=</span> <span class="st">"tz1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="../reference/specials.html">cumulative</a></span><span class="op">(</span><span class="fu">latency</span><span class="op">(</span><span class="va">tz2</span><span class="op">)</span>, <span class="va">z.tz2</span>, tz_var <span class="op">=</span> <span class="st">"tz2"</span><span class="op">)</span>,</span>
<span>  cut <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  id <span class="op">=</span> <span class="st">"id"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">ped_sim</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Classes 'fped', 'ped' and 'data.frame':  1004 obs. of  15 variables:</span></span>
<span><span class="co">##  $ id          : int  1 1 1 1 2 2 2 2 2 2 ...</span></span>
<span><span class="co">##  $ tstart      : num  0 1 2 3 0 1 2 3 4 5 ...</span></span>
<span><span class="co">##  $ tend        : int  1 2 3 4 1 2 3 4 5 6 ...</span></span>
<span><span class="co">##  $ interval    : Factor w/ 10 levels "(0,1]","(1,2]",..: 1 2 3 4 1 2 3 4 5 6 ...</span></span>
<span><span class="co">##  $ offset      : num  0 0 0 -1.53 0 ...</span></span>
<span><span class="co">##  $ ped_status  : num  0 0 0 1 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ x1          : num  1.59 1.59 1.59 1.59 -0.53 ...</span></span>
<span><span class="co">##  $ x2          : num  4.612 4.612 4.612 4.612 0.178 ...</span></span>
<span><span class="co">##  $ time_tz1_mat: int [1:1004, 1:10] 0 1 2 3 0 1 2 3 4 5 ...</span></span>
<span><span class="co">##  $ tz1_latency : num [1:1004, 1:10] 0 0 1 2 0 0 1 2 3 4 ...</span></span>
<span><span class="co">##  $ z.tz1_tz1   : num [1:1004, 1:10] -2.014 -2.014 -2.014 -2.014 -0.978 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ LL_tz1      : num [1:1004, 1:10] 0 1 1 1 0 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ tz2_latency : num [1:1004, 1:11] 5 6 7 8 5 6 7 8 9 10 ...</span></span>
<span><span class="co">##  $ z.tz2_tz2   : num [1:1004, 1:11] -0.689 -0.689 -0.689 -0.689 0.693 ...</span></span>
<span><span class="co">##   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">##  $ LL_tz2      : num [1:1004, 1:11] 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  - attr(*, "breaks")= int [1:11] 0 1 2 3 4 5 6 7 8 9 ...</span></span>
<span><span class="co">##  - attr(*, "id_var")= chr "id"</span></span>
<span><span class="co">##  - attr(*, "intvars")= chr [1:6] "id" "tstart" "tend" "interval" ...</span></span>
<span><span class="co">##  - attr(*, "trafo_args")=List of 3</span></span>
<span><span class="co">##  - attr(*, "time_var")= chr "time"</span></span>
<span><span class="co">##  - attr(*, "status_var")= chr "status"</span></span>
<span><span class="co">##  - attr(*, "func")=List of 2</span></span>
<span><span class="co">##  - attr(*, "ll_funs")=List of 2</span></span>
<span><span class="co">##  - attr(*, "tz")=List of 2</span></span>
<span><span class="co">##  - attr(*, "tz_vars")=List of 2</span></span>
<span><span class="co">##  - attr(*, "ll_weights")=List of 2</span></span>
<span><span class="co">##  - attr(*, "func_mat_names")=List of 2</span></span></code></pre>
<p>Note how the matrix covariates associated with <code>tz1</code> have
10 columns while matrix covariates associated with <code>tz2</code> have
11 columns. Note also that the lag-lead matrices differ</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gg_laglead.html">gg_laglead</a></span><span class="op">(</span><span class="va">ped_sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="data-transformation_files/figure-html/unnamed-chunk-17-1.png" width="600px" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Bender2018" class="csl-entry">
Bender, Andreas, Fabian Scheipl, Wolfgang Hartl, Andrew G. Day, and
Helmut Küchenhoff. 2018. <span>“Penalized Estimation of Complex,
Non-Linear Exposure-Lag-Response Associations.”</span>
<em>Biostatistics</em>. <a href="https://doi.org/10.1093/biostatistics/kxy003" class="external-link">https://doi.org/10.1093/biostatistics/kxy003</a>.
</div>
<div id="ref-Gasparrini2017" class="csl-entry">
Gasparrini, Antonio, Fabian Scheipl, Ben Armstrong, and Michael G.
Kenward. 2017. <span>“A Penalized Framework for Distributed Lag
Non-Linear Models.”</span> <em>Biometrics</em> 73: 938–48. <a href="https://doi.org/10.1111/biom.12645" class="external-link">https://doi.org/10.1111/biom.12645</a>.
</div>
<div id="ref-Sylvestre2009" class="csl-entry">
Sylvestre, Marie-Pierre, and Michal Abrahamowicz. 2009. <span>“Flexible
Modeling of the Cumulative Effects of Time-Dependent Exposures on the
Hazard.”</span> <em>Statistics in Medicine</em> 28 (27): 3437–53. <a href="https://doi.org/10.1002/sim.3701" class="external-link">https://doi.org/10.1002/sim.3701</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andreas Bender, Fabian Scheipl, Philipp Kopper.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: 'c3726dcbf089f0b26f496305ed030c22',
    indexName: 'pammtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
