<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulating Time-To-Event Data • pammtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Simulating Time-To-Event Data">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44545040-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44545040-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pammtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-transformation.html">Data transformation</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Estimating the baseline hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic modeling</a>
    </li>
    <li>
      <a href="../articles/splines.html">Non-linear effects (penalized splines)</a>
    </li>
    <li>
      <a href="../articles/convenience.html">Workflow and convenience functions</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified models</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects (TVEs)</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailties (random effects)</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates (TDCs)</a>
    </li>
    <li>
      <a href="../articles/left-truncation.html">Left-truncated data</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/cumulative-effects.html">Cumulative effects/Exposure-Lag-Response Associations</a>
    </li>
    <li>
      <a href="../articles/competing-risks.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent Events</a>
    </li>
    <li>
      <a href="../articles/multi-state.html">Multi-State Modelling</a>
    </li>
    <li>
      <a href="../articles/simulations.html">Simulating Time-To-Event Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/pammtools" class="external-link">
    <span class="fa fa-github fa-lg"></span>

  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>

    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Simulating Time-To-Event Data</h1>
                        <h4 data-toc-skip class="author">Andreas Bender,
Johannes Piller</h4>
            
            <h4 data-toc-skip class="date">2025-08-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/pammtools/blob/master/vignettes/simulations.Rmd" class="external-link"><code>vignettes/simulations.Rmd</code></a></small>
      <div class="hidden name"><code>simulations.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/">pammtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For convenience, the <code>pammtools</code> package contains a
lightweight, but versatile function for the simulation of time-to-event
data, with potentially smooth, smoothly time-varying effects. For the
simulation of survival times we use the Piece-wise exponential
distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∼</mo><mtext mathvariant="normal">PEXP</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛌</mi><mo>,</mo><mtext mathvariant="bold">𝐭</mtext><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">t \sim \text{PEXP}(\boldsymbol{\lambda}, \textbf{t})</annotation></semantics></math>,
which is implemented in the <code>msm</code> package <span class="citation">(Jackson 2011)</span>. Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
is a vector of hazards at time points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">𝐭</mtext><annotation encoding="application/x-tex">\textbf{t}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
can be specified conveniently using a <code>formula</code> notation.</p>
<p>In Section <a href="#motivation">Motivation</a>, we empirically
demonstrate that even crude PEXP hazards can be used to simulate
survival times from continuous distributions. In Section <a href="#sim:tcc">Flexible, covariate dependent simulation of survival
times</a>, we illustrate the simulation of survival times based on
hazard rates that flexibly depend on time-constant covariates. Lastly,
Section <a href="#sim:tdc">Simulation of survival times with cumulative
effects</a> shows how to simulate from hazards with cumulative effects
of TDCs.</p>
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>We use a simple Weibull baseline hazard model to illustrate that the
function indeed simulates event times from the desired distribution,
even though the hazards
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛌</mi><annotation encoding="application/x-tex">\boldsymbol{\lambda}</annotation></semantics></math>
are assumed to be piece-wise constant between two time-points in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtext mathvariant="bold">𝐭</mtext><annotation encoding="application/x-tex">\textbf{t}</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Weibull hazard function</span></span>
<span><span class="va">hweibull</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">lambda</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">dweibull</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">lambda</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">pweibull</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">lambda</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># plot hazard and survival probability:</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1.5</span></span>
<span><span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, by<span class="op">=</span><span class="fl">.01</span><span class="op">)</span></span>
<span><span class="va">wb_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t <span class="op">=</span> <span class="va">t</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span></span>
<span>    hazard   <span class="op">=</span> <span class="fu"><a href="https://ehar.se/r/eha/reference/Weibull.html" class="external-link">hweibull</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">lambda</span><span class="op">)</span>,</span>
<span>    survival <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">pweibull</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">alpha</span>, <span class="va">lambda</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The figure below depicts the hazard rate and survivor function of a
Weibull distribution with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mo>∼</mo><mi>W</mi><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>α</mi><mo>=</mo><mn>1.5</mn><mo>,</mo><mi>λ</mi><mo>=</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">T \sim WB(\alpha = 1.5, \lambda = 10)</annotation></semantics></math>.</p>
<div class="figure" style="text-align: center">
<img src="simulations_files/figure-html/viz_wb-1.png" alt="Hazard rate (left) and survivor function (right) of the $WB(1.5, 10)$ distribution." width="345.6"><p class="caption">
Hazard rate (left) and survivor function (right) of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1.5</mn><mo>,</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">WB(1.5, 10)</annotation></semantics></math>
distribution.
</p>
</div>
<div class="figure" style="text-align: center">
<img src="simulations_files/figure-html/gg-pem-hazard-1.png" alt="PEM estimates of the baseline hazard $\lambda(t)$ (left panel) and survival probability $S(t)$ (right panel). Red lines indicate the true Weibull hazard and survival probability, respectively." width="384"><p class="caption">
PEM estimates of the baseline hazard
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda(t)</annotation></semantics></math>
(left panel) and survival probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">S(t)</annotation></semantics></math>
(right panel). Red lines indicate the true Weibull hazard and survival
probability, respectively.
</p>
</div>
<p>The figure above (left panel) shows the baseline hazard estimated by
a PEM with 10 intervals based on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n=1000</annotation></semantics></math>
survival times simulated from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1.5</mn><mo>,</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">WB(1.5, 10)</annotation></semantics></math>.
Although the approximation of the underlying smooth hazard is relatively
crude, the survival function calculated from this step hazard is very
close to the true survivor function (cf. right panel).</p>
<p>Finally, below, we depict the distribution of survival times
(Kaplan-Meier estimates) for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>1000</mn></mrow><annotation encoding="application/x-tex">n=1000</annotation></semantics></math>
survival times simulated directly from the correct Weibull distribution
(<code>rweibull(n, 1.5, 10)</code>) on the one hand and from the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>E</mi><mi>X</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">PEXP</annotation></semantics></math>
distribution (based on the crude hazard) on the other hand.</p>
<div class="figure" style="text-align: center">
<img src="simulations_files/figure-html/gg-pem-wb-surv-1.png" alt="Comparison of Kaplan-Meier survival probability estimates based on survival times simulated directly from the Weibull distribution $WB(1.5, 10)$ and based on survival times simulated from the $PEXP$ distribution based on the hazards depicted above. The black line indicates the true Weibull survival probability on $t\in [0, 10]$." width="345.6"><p class="caption">
Comparison of Kaplan-Meier survival probability estimates based on
survival times simulated directly from the Weibull distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>W</mi><mi>B</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1.5</mn><mo>,</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">WB(1.5, 10)</annotation></semantics></math>
and based on survival times simulated from the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>E</mi><mi>X</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">PEXP</annotation></semantics></math>
distribution based on the hazards depicted above. The black line
indicates the true Weibull survival probability on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">[</mo><mn>0</mn><mo>,</mo><mn>10</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">t\in [0, 10]</annotation></semantics></math>.
</p>
</div>
</div>
<div class="section level2">
<h2 id="sim:tcc">Flexible, covariate dependent simulation of survival times<a class="anchor" aria-label="anchor" href="#sim:tcc"></a>
</h2>
<p>To simulate survival times from the PEXP distribution conveniently,
<code>pammtools</code> provides the <code>sim_pexp</code> function.
Similar to the <code>as_ped</code> function, it uses a formula
interface, which allows to specify complex hazards relatively easily. To
start, we simulate data from
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>3.5</mn><mo>+</mo><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>0.5</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msqrt><msub><mi>x</mi><mn>2</mn></msub></msqrt><mo>,</mo></mrow><annotation encoding="application/x-tex">
  \log(\lambda(t|x_1, x_2)) = -3.5 + f_0(t) -0.5 x_1 + \sqrt{x_2},
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_0(t)</annotation></semantics></math>
is based on the Gamma(8,2) density function. Any existing or previously
defined function can be used in the <code>formula</code> argument to
<code>sim_pexp</code>. The argument <code>cut</code> defines the
time-points at which the piece-wise constant hazard will change its
value, for example, the hazard will change its value at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>t</mi><mo>=</mo><mn>2</mn><mo>,</mo><mi>…</mi></mrow><annotation encoding="application/x-tex">t=1, t=2, \ldots</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">f_0(t)</annotation></semantics></math>
(and other time-varying effects) evaluated at the respective interval
end-points. <code>sim_pexp</code> returns the original data augmented by
the simulated survival times (<code>time</code>) as well as a
<code>status</code> column.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># basic data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7042018</span><span class="op">)</span></span>
<span><span class="co"># create data set with covariates</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span><span class="fl">1000</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># baseline hazard function</span></span>
<span><span class="va">f0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">dgamma</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">8</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fl">6</span><span class="op">}</span></span>
<span><span class="co"># simulate data from PEXP</span></span>
<span><span class="va">sim_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_pexp.html">sim_pexp</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">3.5</span> <span class="op">+</span> <span class="fu">f0</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">df</span>,</span>
<span>  cut     <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>We evaluate the simulated data by comparing estimates of the Cox PH
model and the PAM estimates.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for comparison, estimate with Cox PH</span></span>
<span><span class="va">mod_cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/pspline.html" class="external-link">pspline</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">sim_df</span><span class="op">)</span></span>
<span><span class="co"># and using PAMs</span></span>
<span><span class="va">ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_data.html">split_data</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span><span class="op">~</span><span class="va">.</span>, data <span class="op">=</span> <span class="va">sim_df</span>, cut <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span><span class="va">mod_pam</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html" class="external-link">gam</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">ped_status</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html" class="external-link">s</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">ped</span>,</span>
<span>  family  <span class="op">=</span> <span class="va">poisson</span>,</span>
<span>  offset  <span class="op">=</span> <span class="va">offset</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>PAM <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_pam</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> , COX <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">mod_cph</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           PAM        COX</span></span>
<span><span class="co">## x1 -0.5573143 -0.5578749</span></span></code></pre>
<p>Note that the simulation could be easily extended to contain
time-varying effects, e.g. by defining a function</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">f_tx</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span></span></code></pre></div>
<p>and calling</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sim_pexp.html">sim_pexp</a></span><span class="op">(</span><span class="op">~</span> <span class="op">-</span><span class="fl">3.5</span> <span class="op">+</span> <span class="fu">f0</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fu">f_tx</span><span class="op">(</span><span class="va">t</span>, <span class="va">x2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span>, cut <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sim:tdc">Simulation of survival times with cumulative effects<a class="anchor" aria-label="anchor" href="#sim:tdc"></a>
</h2>
<div class="section level3">
<h3 id="weighted-cumulative-exposure">Weighted cumulative exposure<a class="anchor" aria-label="anchor" href="#weighted-cumulative-exposure"></a>
</h3>
<p>In this section we demonstrate how to simulate data with hazard
rates</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext mathvariant="bold">𝐳</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>3.5</mn><mo>+</mo><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>0.5</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msqrt><msub><mi>x</mi><mn>2</mn></msub></msqrt><mo>+</mo><msub><mo>∫</mo><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">d</mtext><msub><mi>t</mi><mi>z</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
\log(\lambda(t|x_1, x_2, \textbf{z})) = -3.5 + f_0(t) -0.5 x_1 + \sqrt{x_2} +
  \int_{\mathcal{T}(t)} h(t-t_z)z(t_z) \text{d}t_z.
</annotation></semantics></math></p>
<p>which constitutes a so-called weighted cumulative exposure model
<span class="citation">(Sylvestre and Abrahamowicz 2009)</span>. The
static part of the data set as well as the baseline hazard and TCC
effects are identical to the <a href="#sim:tdc">previous section</a>.
For the cumulative effect, we define the exposure time grid (i.e., the
time points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
at which the TDC was observed) and use the function <code>add_tdc</code>
(mnemonic: <em>add time-dependent covariate</em>) to add the information
on the exposure times and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(t_z)</annotation></semantics></math>
to the data.</p>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##  [1] -5.00 -4.75 -4.50 -4.25 -4.00 -3.75 -3.50 -3.25 -3.00 -2.75 -2.50 -2.25</span></span>
<span><span class="co">## [13] -2.00 -1.75 -1.50 -1.25 -1.00 -0.75 -0.50 -0.25  0.00  0.25  0.50  0.75</span></span>
<span><span class="co">## [25]  1.00  1.25  1.50  1.75  2.00  2.25  2.50  2.75  3.00  3.25  3.50  3.75</span></span>
<span><span class="co">## [37]  4.00  4.25  4.50  4.75  5.00</span></span></code></pre>
<p>The partial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z)z(t_z)</annotation></semantics></math>
(see function <code>f_wce</code>) and the lag-lead window
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math>
(see function <code>ll_fun</code>) are defined and depicted below.</p>
<p>The left panel of the figure shows the latency-dependent weight
function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z)</annotation></semantics></math>
for the exposures
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(t_z)</annotation></semantics></math>.
The middle panel shows the lag-lead window with partial effects. Note
that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z)</annotation></semantics></math>
only depends on the latency, not the specific combination of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>.
The right panel shows that the cumulative effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="bold">𝐳</mtext><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\textbf{z}, t)</annotation></semantics></math>
varies over
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
even for constant exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>z</mi></mrow><annotation encoding="application/x-tex">z(t_z) = z</annotation></semantics></math>
since it is integrated over different windows of effectiveness
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define lag-lead function: integrate over the preceding 12 time units</span></span>
<span><span class="va">ll_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span><span class="op">)</span> <span class="op">(</span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">tz</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">(</span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">tz</span><span class="op">)</span> <span class="op">&lt;=</span>  <span class="fl">12</span><span class="op">)</span></span>
<span><span class="co"># gg_laglead(0:10, -5:5, ll_fun)</span></span>
<span></span>
<span><span class="co"># partial effect h(t - tz) * z</span></span>
<span><span class="va">f_wce</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">0.5</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">tz</span>, <span class="fl">6</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">z</span></span>
<span><span class="op">}</span></span></code></pre></div>
<details><summary><em>Expand here to see R-Code</em>
</summary><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL_df</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_laglead.html">get_laglead</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">5</span><span class="op">:</span><span class="fl">5</span>, <span class="va">ll_fun</span><span class="op">)</span></span>
<span><span class="va">LL_df</span> <span class="op">&lt;-</span> <span class="va">LL_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>latency <span class="op">=</span> <span class="va">t</span> <span class="op">-</span> <span class="va">tz</span>,</span>
<span>         partial <span class="op">=</span> <span class="fu">f_wce</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">t</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_partial</span> <span class="op">&lt;-</span> <span class="va">LL_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">LL</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span> <span class="op">-</span> <span class="va">tz</span>, y <span class="op">=</span> <span class="va">partial</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">h</span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">LL_df</span><span class="op">$</span><span class="va">partial</span><span class="op">[</span><span class="va">LL_df</span><span class="op">$</span><span class="va">LL</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">gg_partial_LL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">LL_df</span>,</span>
<span>                        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">tz</span>, fill <span class="op">=</span> <span class="va">partial</span> <span class="op">*</span> <span class="va">LL</span>, z <span class="op">=</span> <span class="va">partial</span> <span class="op">*</span> <span class="va">LL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span>, expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">h</span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       na.value <span class="op">=</span> <span class="st">"grey30"</span>, low <span class="op">=</span> <span class="st">"steelblue"</span>, high <span class="op">=</span> <span class="st">"firebrick2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_cumeff</span> <span class="op">&lt;-</span> <span class="va">LL_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>g_z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">partial</span><span class="op">*</span><span class="va">LL</span>, na.rm<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">g_z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">g</span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.6</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="simulations_files/figure-html/gg_partial_wce-1.png" alt="Left: Partial effect $h(t-t_z)$ for different latencies  $t-t_z$. Middle: The lag-lead window $\mathcal{T}(t)$ and respective partial effects for each combination of $t$ and $t_z$. Combinations of $t$ and $t_z$ outside the specified lag-lead window in dark gray. Partial effects of exposures at different time-points $t$, $t_z$ are the same if the latency $t-t_z$ is the same, i.e. $h(5-1) = h(6-2) = h(4)$. Right: Cumulative effect $g( extbf{z},t)$ for constant $z(t_z)=1, orall t_z$." width="768"><p class="caption">
Left: Partial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z)</annotation></semantics></math>
for different latencies
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">t-t_z</annotation></semantics></math>.
Middle: The lag-lead window
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math>
and respective partial effects for each combination of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>.
Combinations of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
outside the specified lag-lead window in dark gray. Partial effects of
exposures at different time-points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
are the same if the latency
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">t-t_z</annotation></semantics></math>
is the same,
i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>5</mn><mo>−</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>6</mn><mo>−</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>4</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(5-1) = h(6-2) = h(4)</annotation></semantics></math>.
Right: Cumulative effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>e</mi><mi>x</mi><mi>t</mi><mi>b</mi><mi>f</mi><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g( extbf{z},t)</annotation></semantics></math>
for constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>,</mo><mi>o</mi><mi>r</mi><mi>a</mi><mi>l</mi><mi>l</mi><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">z(t_z)=1, orall t_z</annotation></semantics></math>.
</p>
</div>
<p>Given the above setup with cumulative effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="bold">𝐳</mtext><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mo>∫</mo><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">d</mtext><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">g(\textbf{z},t)=\int_{\mathcal{T}(t)}h(t-t_z)z(t_z) \text{d}t_z</annotation></semantics></math>,
we can now simulate the data using the <code>sim_pexp</code>
function.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simdf_wce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_pexp.html">sim_pexp</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">3.5</span> <span class="op">+</span> <span class="fu">f0</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">|</span></span>
<span>  <span class="fu"><a href="../reference/fcumu.html">fcumu</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z.tz</span>, f_xyz<span class="op">=</span><span class="va">f_wce</span>, ll_fun<span class="op">=</span><span class="va">ll_fun</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>, cut <span class="op">=</span> <span class="va">time_grid</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bivariate-smooth-partial-effects">Bivariate, smooth partial effects<a class="anchor" aria-label="anchor" href="#bivariate-smooth-partial-effects"></a>
</h3>
<p>In this section, we illustrate an extension of the previous
simulation, where the exposure
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">z(t_z)</annotation></semantics></math>
affects the hazard non-linearly
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext mathvariant="bold">𝐳</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>3.5</mn><mo>+</mo><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>0.5</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msqrt><mrow><mi>x</mi><mn>2</mn></mrow></msqrt><mo>+</mo><msub><mo>∫</mo><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">d</mtext><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">
\log(\lambda(t|x_1, x_2, \textbf{z})) = -3.5 + f_0(t) -0.5 x_1 + \sqrt{x2} +
  \int_{\mathcal{T}(t)} h(t-t_z,z(t_z)) \text{d}t_z
</annotation></semantics></math></p>
<p>Using the <code>sim_pexp</code> function, we can extend the previous
simulation by changing the partial effect function (function
<code>f_dlnm</code>). The figure below depicts the bivariate, smooth
partial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z, z(t_z))</annotation></semantics></math>
and the resulting cumulative effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="bold">𝐳</mtext><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\textbf{z},t)</annotation></semantics></math>
for a simplified exposure history with constant
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">z(t_z)=1</annotation></semantics></math>
for all
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># partial effect h(t - tz) * z</span></span>
<span><span class="va">f_dlnm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fl">20</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">t</span> <span class="op">-</span> <span class="va">tz</span>, <span class="fl">6</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">z</span>, <span class="fl">1.25</span>, <span class="fl">2.5</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1.25</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">simdf_dlnm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_pexp.html">sim_pexp</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">4.5</span> <span class="op">+</span> <span class="fu">f0</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">|</span></span>
<span>     <span class="fu"><a href="../reference/fcumu.html">fcumu</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z.tz</span>, f_xyz<span class="op">=</span><span class="va">f_dlnm</span>, ll_fun<span class="op">=</span><span class="va">ll_fun</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>, cut <span class="op">=</span> <span class="va">time_grid</span><span class="op">)</span></span></code></pre></div>
<details><summary><em>Expand here to see R-Code</em>
</summary><div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">viz_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_laglead.html">get_laglead</a></span><span class="op">(</span><span class="va">time_grid</span>, <span class="va">tz</span>, ll_fun <span class="op">=</span> <span class="va">ll_fun</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="../reference/combine_df.html">combine_df</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="fl">3</span>, by <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span><span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span></span>
<span>  latency <span class="op">=</span> <span class="va">t</span> <span class="op">-</span> <span class="va">tz</span>,</span>
<span>  partial <span class="op">=</span> <span class="fu">f_dlnm</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_partial_dlnm</span> <span class="op">&lt;-</span> <span class="va">viz_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">t</span> <span class="op">==</span> <span class="fl">6</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">LL</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">z</span>, y <span class="op">=</span> <span class="va">latency</span>, z <span class="op">=</span> <span class="va">partial</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">partial</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">h</span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       low <span class="op">=</span> <span class="st">"steelblue"</span>, high<span class="op">=</span><span class="st">"firebrick2"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">t</span><span class="op">-</span><span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">gg_z_dlnm</span> <span class="op">&lt;-</span> <span class="va">viz_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">z</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">z</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>g_z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">*</span><span class="va">partial</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t</span>, y <span class="op">=</span> <span class="va">g_z</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 't'. You can override using the `.groups`</span></span>
<span><span class="co">## argument.</span></span></code></pre>
</details><div class="figure" style="text-align: center">
<img src="simulations_files/figure-html/gg-partial-dlnm-1.png" alt="**Left**: Partial effect $h(t-t_z, z(t_z))$ used for the simulation of survival times. **Right**: The cumulative effects $g(    extbf{z},t)$ resulting from constant exposure histories $z(t_z)=1, \forall t_z$." width="576"><p class="caption">
<strong>Left</strong>: Partial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>−</mo><msub><mi>t</mi><mi>z</mi></msub><mo>,</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t-t_z, z(t_z))</annotation></semantics></math>
used for the simulation of survival times. <strong>Right</strong>: The
cumulative effects
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>e</mi><mi>x</mi><mi>t</mi><mi>b</mi><mi>f</mi><mi>z</mi><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g( extbf{z},t)</annotation></semantics></math>
resulting from constant exposure histories
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>,</mo><mo>∀</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">z(t_z)=1, \forall t_z</annotation></semantics></math>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="bivariate-smooth-of-time-and-exposure-time">Bivariate smooth of time and exposure time<a class="anchor" aria-label="anchor" href="#bivariate-smooth-of-time-and-exposure-time"></a>
</h3>
<p>In this subsection, we simulate the data with hazard
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>x</mi><mn>1</mn></msub><mo>,</mo><msub><mi>x</mi><mn>2</mn></msub><mo>,</mo><mtext mathvariant="bold">𝐳</mtext><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>−</mo><mn>3.5</mn><mo>+</mo><msub><mi>f</mi><mn>0</mn></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><mn>0.5</mn><msub><mi>x</mi><mn>1</mn></msub><mo>+</mo><msqrt><msub><mi>x</mi><mn>2</mn></msub></msqrt><mo>+</mo><msub><mo>∫</mo><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msub><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mtext mathvariant="normal">d</mtext><msub><mi>t</mi><mi>z</mi></msub><mi>.</mi></mrow><annotation encoding="application/x-tex">
  \log(\lambda(t|x_1, x_2, \textbf{z})) = -3.5 + f_0(t) -0.5 x_1 + \sqrt{x_2} +
    \int_{\mathcal{T}(t)} h(t,t_z)z(t_z)\text{d} t_z.
</annotation></semantics></math> Using the <code>sim_pexp</code>
function, we can again extend the previous simulation with the updated
partial effect function <code>f_elra</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># partial effect h(t,tz) * z</span></span>
<span><span class="va">f_elra</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span></span>
<span>   <span class="fl">5</span><span class="op">*</span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">tz</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">2.5</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">t</span>, <span class="fl">5</span>, <span class="fl">1.5</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">z</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">simdf_tv_wce</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_pexp.html">sim_pexp</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="op">-</span><span class="fl">4.5</span> <span class="op">+</span> <span class="fu">f0</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">|</span></span>
<span>     <span class="fu"><a href="../reference/fcumu.html">fcumu</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">z.tz</span>, f_xyz <span class="op">=</span> <span class="va">f_elra</span>, ll_fun <span class="op">=</span> <span class="va">ll_fun</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">df</span>, cut <span class="op">=</span> <span class="va">time_grid</span><span class="op">)</span></span></code></pre></div>
<details><summary><em>Expand here to see R-Code</em>
</summary><div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LL_df_elra</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_laglead.html">get_laglead</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>, by<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5</span>, <span class="fl">5</span>, by<span class="op">=</span><span class="fl">0.25</span><span class="op">)</span>, <span class="va">ll_fun</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>partial <span class="op">=</span> <span class="fu">f_elra</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">LL</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cumu_df_elra</span> <span class="op">&lt;-</span> <span class="va">LL_df_elra</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>cumu_eff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fl">0.25</span><span class="op">*</span><span class="va">partial</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_partial_elra_truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">LL_df_elra</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">t</span>, y <span class="op">=</span> <span class="va">tz</span>, z <span class="op">=</span> <span class="va">partial</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">partial</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">h</span><span class="op">(</span><span class="va">t</span>,<span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      low <span class="op">=</span> <span class="st">"steelblue"</span>, high <span class="op">=</span> <span class="st">"firebrick2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html" class="external-link">geom_contour</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="va">t</span><span class="op">[</span><span class="va">z</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_cumu_elra_truth</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cumu_df_elra</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t</span>, y <span class="op">=</span> <span class="va">cumu_eff</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu">g</span><span class="op">(</span><span class="fu">bold</span><span class="op">(</span><span class="va">z</span><span class="op">)</span>, <span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</details><p>The figure below depicts the bivariate, smooth partial effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t, t_z)</annotation></semantics></math>
(left panel) and the resulting cumulative effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>g</mi><mrow><mo stretchy="true" form="prefix">(</mo><mtext mathvariant="bold">𝐳</mtext><mo>,</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">g(\textbf{z},t)</annotation></semantics></math>
for a simplified exposure history with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>∀</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">z(t_z)=1 \forall t_z</annotation></semantics></math>
(right panel).</p>
<div class="figure" style="text-align: center">
<img src="simulations_files/figure-html/unnamed-chunk-7-1.png" alt="**Left**: Bivariate partial effect surface $h(t, t_z)$, combinations of $t$ and $t_z$ that lie outside the lag-lead window $\mathcal{T}(t)$ are omitted. **Right**: The cumulative effect resulting from the partial effect depicted in the left panel for a simplified exposure profile with $z(t_z)=1, \forall t_z$." width="576"><p class="caption">
<strong>Left</strong>: Bivariate partial effect surface
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>h</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">h(t, t_z)</annotation></semantics></math>,
combinations of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>z</mi></msub><annotation encoding="application/x-tex">t_z</annotation></semantics></math>
that lie outside the lag-lead window
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝒯</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{T}(t)</annotation></semantics></math>
are omitted. <strong>Right</strong>: The cumulative effect resulting
from the partial effect depicted in the left panel for a simplified
exposure profile with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>z</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn><mo>,</mo><mo>∀</mo><msub><mi>t</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">z(t_z)=1, \forall t_z</annotation></semantics></math>.
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<!-- Zaehlmarke VGWort -->
<p><img src="https://vg09.met.vgwort.de/na/f993b9c06b5249adb509a4df30d807a6" width="1" height="1" alt=""></p>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Jackson2011" class="csl-entry">
Jackson, Christopher. 2011. <span>“Multi-State Models for Panel Data:
The Msm Package for r.”</span> <em>Journal of Statistical Software</em>
38 (8): 1–28. <a href="https://doi.org/10.18637/jss.v038.i08" class="external-link">https://doi.org/10.18637/jss.v038.i08</a>.
</div>
<div id="ref-Sylvestre2009" class="csl-entry">
Sylvestre, Marie-Pierre, and Michal Abrahamowicz. 2009. <span>“Flexible
Modeling of the Cumulative Effects of Time-Dependent Exposures on the
Hazard.”</span> <em>Statistics in Medicine</em> 28 (27): 3437–53. <a href="https://doi.org/10.1002/sim.3701" class="external-link">https://doi.org/10.1002/sim.3701</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Andreas Bender, Fabian Scheipl, Johannes Piller, Philipp Kopper.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: 'c3726dcbf089f0b26f496305ed030c22',
    indexName: 'pammtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
