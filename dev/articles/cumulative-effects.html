<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cumulative Effects • pammtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Cumulative Effects">
<meta property="og:description" content="pammtools">
<meta property="og:image" content="https://adibender.github.io/pammtools/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-44545040-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-44545040-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pammtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Version">0.5.7.901</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data-transformation.html">Data transformation</a>
    </li>
    <li>
      <a href="../articles/baseline.html">Estimating the baseline hazard</a>
    </li>
    <li>
      <a href="../articles/basics.html">Basic modeling</a>
    </li>
    <li>
      <a href="../articles/splines.html">Non-linear effects (penalized splines)</a>
    </li>
    <li>
      <a href="../articles/convenience.html">Workflow and convenience functions</a>
    </li>
    <li>
      <a href="../articles/strata.html">Stratified models</a>
    </li>
    <li>
      <a href="../articles/tveffects.html">Time-varying effects (TVEs)</a>
    </li>
    <li>
      <a href="../articles/frailty.html">Frailties (random effects)</a>
    </li>
    <li>
      <a href="../articles/tdcovar.html">Time-dependent covariates (TDCs)</a>
    </li>
    <li>
      <a href="../articles/left-truncation.html">Left-truncated data</a>
    </li>
    <li>
      <a href="../articles/model-evaluation.html">Model evaluation</a>
    </li>
    <li>
      <a href="../articles/cumulative-effects.html">Cumulative effects/Exposure-Lag-Response Associations</a>
    </li>
    <li>
      <a href="../articles/competing-risks.html">Competing Risks</a>
    </li>
    <li>
      <a href="../articles/recurrent-events.html">Recurrent Events</a>
    </li>
    <li>
      <a href="../articles/smj-tutorial.html">Paper: A generalized additive model approach to time-to-event analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adibender/pammtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="cumulative-effects_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cumulative Effects</h1>
            
            <h4 class="date">2021-11-26</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/adibender/pammtools/blob/master/vignettes/cumulative-effects.Rmd"><code>vignettes/cumulative-effects.Rmd</code></a></small>
      <div class="hidden name"><code>cumulative-effects.Rmd</code></div>

    </div>

    
    
<p>This vignette provides a short reference for the estimation and interpretation of cumulative effects using <strong><code>pammtools</code></strong>. For a more detailed overview see <span class="citation">Bender and Scheipl (<a href="#ref-Bender2018f" role="doc-biblioref">2018</a>)</span>. In the <a href="cumulative-effects.html#introduction">first section</a>, a short introduction to cumulative effects is provided. In the <a href="cumulative-effects.html#example-sofa-score-and-extubation">second section</a>, we present a worked example on a real data set, including necessary data transformation, model estimation and visualization.</p>
<details><p><summary>R Setup</summary></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://adibender.github.io/pammtools/">pammtools</a></span><span class="op">)</span></code></pre></div>
</details><div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>Cumulative effects can be thought of as an extension to the modeling of time-constant effects of time-dependent covariates (TDCs; see vignette on <a href="./tdcovar.html">time-dependent covariates</a>). Standard modeling of TDCs assumes that only the current (or one lagged) value of the covariate can affect the hazard at time <span class="math inline">\(t\)</span>, i.e., <span class="math display">\[\lambda(t|z(t)) = \lambda_0(t)\exp(\beta z(t)).\]</span></p>
<p>Cumulative effects on the other hand allow the hazard at time <span class="math inline">\(t\)</span> to depend on multiple past observations of the covariate, such that the effect at time <span class="math inline">\(t\)</span> is the sum of all weighted effects of past observations (partial effects). to make this more concrete, consider the following quantities:</p>
<ul>
<li>
<span class="math inline">\(t\)</span>: the follow-up time</li>
<li>
<span class="math inline">\(t_z\)</span>: the time at which the TDC <span class="math inline">\(z\)</span> was observed (exposure time)</li>
<li>
<span class="math inline">\(z(t_z)\)</span>: the value of covariate <span class="math inline">\(z\)</span> at exposure time <span class="math inline">\(t_z\)</span>
</li>
<li>
<span class="math inline">\(\mathbf{z} = \{z(t_{z}):t_z \leq t\}\)</span>: the exposure history of TDC <span class="math inline">\(z\)</span>, i.e., all recorded observations of the TDC (at time t).</li>
</ul>
<p>Given these definitions, one possible specification of a model with a cumulative effect was suggested by <span class="citation">Sylvestre and Abrahamowicz (<a href="#ref-Sylvestre2009" role="doc-biblioref">2009</a>)</span> and is given below:</p>
<p><span class="math display">\[
\lambda(t|\mathbf{z}) = \lambda_0(t)\exp\left(\sum_{t_z \leq t} h(t-t_z)z(t_z)\right)
\]</span></p>
<p>Here, past observations are weighted by a (potentially) non-linear function <span class="math inline">\(h\)</span> of the <em>latency</em> (<span class="math inline">\(t-t_z\)</span>), i.e., the time that has passed since covariate <span class="math inline">\(z(t_z)\)</span> was observed, relative to the time of interest <span class="math inline">\(t\)</span>. The cumulative effect is then the sum of all <em>partial effects</em> <span class="math inline">\(h(t-t_z)z(t_z)\)</span>.</p>
<p>The above model also makes some simplifying assumptions, e.g.:</p>
<ul>
<li>the partial effect of the TDC (<span class="math inline">\(z\)</span>) is linear in the covariate values</li>
<li>the weighting function <span class="math inline">\(h\)</span> only depends on the latency, not on the specific combination of follow-up <span class="math inline">\(t\)</span> and <em>exposure time</em> <span class="math inline">\(t_z\)</span>
</li>
<li>the covariate has been observed in 1 unit steps w.r.t. time-scale <span class="math inline">\(t\)</span>
</li>
</ul>
<p>A more flexible cumulative effect can be defined as follows:</p>
<p><span class="math display">\[
g(\mathbf{z}, t) = \int_{\mathcal{T}(t)}h(t, t_z, z(t_z))\mathrm{d}t_z,
\]</span></p>
<p>with</p>
<ul>
<li>
<span class="math inline">\(g(\mathbf{z},t)\)</span>: the cumulative effect of covariate history <span class="math inline">\(\mathbf{z}\)</span> on the hazard at time <span class="math inline">\(t\)</span> (numerically, the integral is usually approximated by a weighted sum)</li>
<li>
<span class="math inline">\(h(t, t_z, z(t_z))\)</span>: the contribution of covariate <span class="math inline">\(z\)</span> observed at time <span class="math inline">\(t_z\)</span> with value <span class="math inline">\(z(t_z)\)</span> to the cumulative effect at time <span class="math inline">\(t\)</span> (<em>partial effect</em> in the following). In the framework of PAMMs, these partial effects ares estimated by penalized splines.</li>
<li>
<span class="math inline">\(\mathcal{T}(t)\)</span>: the integration limits (lag-lead window) that control how many past observations of <span class="math inline">\(\mathbf{z}\)</span> contribute to the cumulative effect at time <span class="math inline">\(t\)</span>. The minimal requirement is <span class="math inline">\(\mathcal{T}(t)=\{t_{z}: t_z \leq t\}\)</span>, i.e., only past observations of the TDC can contribute to the cumulative effect at time <span class="math inline">\(t\)</span>.</li>
</ul>
<p>A visual representation of exemplary lag-lead windows is depicted below:</p>
<details><p><summary> R-Code lag-lead windows </summary></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_ll1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg_laglead.html">gg_laglead</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span>, ll_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span><span class="op">)</span> <span class="va">t</span> <span class="op">&gt;=</span> <span class="va">tz</span><span class="op">)</span>
<span class="va">my_ll_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span>, <span class="va">tlag</span> <span class="op">=</span> <span class="fl">2</span>, <span class="va">tlead</span> <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">t</span> <span class="op">&gt;=</span> <span class="va">tz</span> <span class="op">+</span> <span class="va">tlag</span> <span class="op">&amp;</span> <span class="va">t</span> <span class="op">&lt;</span> <span class="va">tz</span> <span class="op">+</span> <span class="va">tlag</span> <span class="op">+</span> <span class="va">tlead</span>
<span class="op">}</span>
<span class="va">p_ll2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg_laglead.html">gg_laglead</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">9</span>, ll_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span><span class="op">)</span> <span class="va">t</span> <span class="op">==</span> <span class="va">tz</span><span class="op">)</span></code></pre></div>
</details><div class="figure" style="text-align: center">
<img src="cumulative-effects_files/figure-html/unnamed-chunk-4-1.png" alt="Illustration of two different lag-lead windows." width="600px"><p class="caption">
Illustration of two different lag-lead windows.
</p>
</div>
<ul>
<li><p>The left panel represents the minimal requirement <span class="math inline">\(\mathcal{T}(t)=\{t_{z}: t_z \leq t\}\)</span>. For example, the observation of the TDC at time <span class="math inline">\(t_z=4\)</span>, starts to contribute to the cumulative effect in interval <span class="math inline">\((4,5]\)</span> and continues to contribute until the last interval <span class="math inline">\((9,10]\)</span>, although with potentially different weights, as, in general, <span class="math inline">\(h(t=5, t_z = 4, z(4))\)</span> can be different to <span class="math inline">\(h(t=10, t_z=4, z(4))\)</span>.</p></li>
<li><p>The right panel illustrates that a “standard” model for time-to-event data with a constant effect follows as a special case of the general definition of the cumulative effect with lag-lead window <span class="math inline">\(\mathcal{T}(t)=\{t_{z}: t_z = t\}\)</span> and <span class="math inline">\(h(t, t_z, z(t_z)) \equiv \beta z(t)\)</span></p></li>
</ul>
</div>
<div id="example-sofa-score-and-extubation" class="section level2">
<h2 class="hasAnchor">
<a href="#example-sofa-score-and-extubation" class="anchor"></a>Example: SOFA-score and extubation</h2>
<p>For an illustration of the functionality that <strong><code>pammtools</code></strong> provides to work with cumulative effects, we use (a sample) of the data analyzed in <span class="citation">Heyard et al. (<a href="#ref-Heyard2018" role="doc-biblioref">2018</a>)</span> and provided in the package <strong><code>TBFmultinomial</code></strong> (note that their analyses had a totally different goal, including modeling of competing risks; here we simply use the data for illustrative purposes).</p>
<p>In the following analysis, we will model the (cause-specific) hazard for the event <code>extubation</code>, considering all competing events as censoring events. Covariates include <code>gender</code>, <code>type</code> (admission type), <code>SAPSadmission</code> (SAPS score at admission) and the time-dependent covariate <code>SOFA</code> score (lower scores indicate better health).</p>
<p>To use the data for our purposes, we first perform some preprocessing, which produces two data sets:</p>
<ul>
<li>
<code>event_df</code>: Data in “standard” format (one row per subject), that only includes time-constant covariates</li>
<li>
<code>tdc_df</code>: Data containing information on time-dependent covariates (here <code>SOFA</code>) and exposure time <span class="math inline">\(t_z\)</span>
</li>
</ul>
<details><p><summary>R-Code data preprocessing</summary></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">VAP_data</span>, package <span class="op">=</span> <span class="st">"TBFmultinomial"</span><span class="op">)</span>
<span class="co"># create unique IDs</span>
<span class="va">VAP_data</span> <span class="op">&lt;-</span> <span class="va">VAP_data</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>tmp_id <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">day</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>csdup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span><span class="op">(</span><span class="va">tmp_id</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">csdup</span> <span class="op">&gt;</span> <span class="fl">0</span>, <span class="va">ID</span> <span class="op">+</span> <span class="fl">1000</span>, <span class="va">ID</span><span class="op">)</span><span class="op">)</span>

<span class="co"># assume constant SOFA score between updates</span>
<span class="va">VAP_complete</span> <span class="op">&lt;-</span> <span class="va">VAP_data</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">day</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/complete.html">complete</a></span><span class="op">(</span><span class="va">ID</span>, day <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/full_seq.html">full_seq</a></span><span class="op">(</span><span class="va">day</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/tidyr_verbs.html">fill</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">type</span>, <span class="va">SAPSadmission</span>, <span class="va">SOFA</span>, <span class="va">outcome</span>, <span class="va">time</span>, .direction <span class="op">=</span> <span class="st">"down"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">day</span> <span class="op">&lt;=</span> <span class="va">time</span><span class="op">)</span>

<span class="va">event_df</span> <span class="op">&lt;-</span> <span class="va">VAP_complete</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">gender</span>, <span class="va">type</span>, <span class="va">SAPSadmission</span>, <span class="va">outcome</span>, <span class="va">time</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">group_by</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="va">outcome</span> <span class="op">==</span> <span class="st">"extubated"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">tdc_df</span> <span class="op">&lt;-</span> <span class="va">VAP_complete</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">day</span>, <span class="va">SOFA</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">mutate</a></span><span class="op">(</span>day <span class="op">=</span> <span class="va">day</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># assume that SOFA available at the beginning of the day</span>
  <span class="fu"><a href="../reference/dplyr_verbs.html">filter</a></span><span class="op">(</span><span class="va">day</span> <span class="op">&lt;=</span> <span class="fl">49</span><span class="op">)</span></code></pre></div>
</details><p> </p>
<p>An overview of the preprocessed data is given below:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">event_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##      ID gender type    SAPSadmission outcome  time
##   &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;           &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;
## 1     2 0      Medical            50       0     5
## 2     3 1      Medical            34       1     9
## 3     4 0      Medical            45       0     7
## 4     5 1      Medical            21       0    15
## 5     6 1      Medical            50       0     6
## 6     8 0      Medical            54       1     3</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tdc_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##      ID   day  SOFA
##   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1     2     0     9
## 2     2     1     8
## 3     2     2     9
## 4     2     3     9
## 5     2     4     8
## 6     3     0    10</code></pre>
<div class="figure" style="text-align: center">
<img src="cumulative-effects_files/figure-html/unnamed-chunk-7-1.png" alt="SOFA profiles for individual patients. Each line represents a patient, each pixel represents a measurement." width="600px"><p class="caption">
SOFA profiles for individual patients. Each line represents a patient, each pixel represents a measurement.
</p>
</div>
<div id="data-transformation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-transformation" class="anchor"></a>Data transformation</h3>
<p>For illustration, we fit a DLNM <span class="citation">(Gasparrini et al. <a href="#ref-Gasparrini2017" role="doc-biblioref">2017</a>)</span> with cumulative effect of the SOFA score (<span class="math inline">\(z\)</span>) as defined below:</p>
<p><span class="math display">\[
g(\mathbf{z}, t) = \int_{\mathcal{T}(t)}h(t-t_z, z(t_z))\mathrm{d}t_z,
\]</span></p>
<p>with <span class="math inline">\(\mathcal{T}(t) = \{t_z: t_z \leq t \leq t_z + 5\}\)</span>, which means that only the SOFA scores observed within the last five days can affect the hazard at time <span class="math inline">\(t\)</span>.</p>
<p><a href="https://adibender.github.io/pammtools/articles/data-transformation.html#data-with-time-dependent-covariates-with-cumulative-effects">Remember</a> that the specification of the partial effect <span class="math inline">\(h(t,t_z, z(t_z))\)</span> as well as the definition of the lag-lead window are important parts of the analysis and need to be considered at the beginning of the analysis as this information goes into the code for the data transformation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ped</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_ped.html">as_ped</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">event_df</span>, <span class="va">tdc_df</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">outcome</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="fu"><a href="../reference/cumulative.html">cumulative</a></span><span class="op">(</span><span class="fu">latency</span><span class="op">(</span><span class="va">day</span><span class="op">)</span>, <span class="va">SOFA</span>, tz_var <span class="op">=</span> <span class="st">"day"</span>,
      ll_fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">tz</span><span class="op">)</span> <span class="va">t</span> <span class="op">&gt;=</span> <span class="va">tz</span> <span class="op">&amp;</span>  <span class="va">t</span> <span class="op">&lt;=</span> <span class="va">tz</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span>,
  cut <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">49</span>, <span class="co"># administrative censoring at t = 49</span>
  id <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span>
<span class="va">ped</span><span class="op">$</span><span class="va">day_latency</span> <span class="op">&lt;-</span> <span class="va">ped</span><span class="op">$</span><span class="va">day_latency</span> <span class="op">*</span> <span class="va">ped</span><span class="op">$</span><span class="va">LL</span></code></pre></div>
<p>Above, we</p>
<ul>
<li>used the formula special <code>cumulative</code> to inform <code>as_ped</code> to perform data preprocessing in order to fit cumulative effects</li>
<li>wrapped the variable <code>day</code> (<span class="math inline">\(t_z\)</span>) within the <code>latency</code> function to calculate <span class="math inline">\(t - t_z\)</span>
</li>
<li>customized the <code>ll_fun</code> argument to match the desired specification of <span class="math inline">\(\mathcal{T}(t)\)</span>
</li>
</ul>
<p>Note that the data now contains 3 matrix columns (<code>day_latency</code>, <code>SOFA</code> and <code>LL</code>; the latter stores the lag-lead matrix <span class="math inline">\(\mathcal{T}(t)\)</span>):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">ped</span>, <span class="fl">1</span><span class="op">)</span></code></pre></div>
<pre><code>## Classes 'fped', 'ped' and 'data.frame':  1514 obs. of  12 variables:
##  $ ID           : num  2 2 2 2 2 3 3 3 3 3 ...
##  $ tstart       : num  0 1 2 3 4 0 1 2 3 4 ...
##  $ tend         : int  1 2 3 4 5 1 2 3 4 5 ...
##  $ SAPSadmission: int  50 50 50 50 50 34 34 34 34 34 ...
##  $ day_latency  : num [1:1514, 1:50] 0 1 2 3 4 0 1 2 3 4 ...
##  $ SOFA         : num [1:1514, 1:50] 9 9 9 9 9 10 10 10 10 10 ...
##   ..- attr(*, "dimnames")=List of 2
...</code></pre>
<div class="figure" style="text-align: center">
<img src="cumulative-effects_files/figure-html/unnamed-chunk-10-1.png" alt="Lag-lead window for the first 10 days of the follow-up." width="400px"><p class="caption">
Lag-lead window for the first 10 days of the follow-up.
</p>
</div>
</div>
<div id="model-estimation" class="section level3">
<h3 class="hasAnchor">
<a href="#model-estimation" class="anchor"></a>Model estimation</h3>
<p>After successful data transformation with <code>as_ped</code>, the model can be estimated directly using <code><a href="https://rdrr.io/pkg/mgcv/man/gam.html">mgcv::gam</a></code>. Including matrix columns into the model specification will inform <code>gam</code> to estimate cumulative effects. In our case the the following call estimates the DLNM with a cumulative effect (of the SOFA score) as specified above:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/gam.html">gam</a></span><span class="op">(</span><span class="va">ped_status</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/s.html">s</a></span><span class="op">(</span><span class="va">tend</span><span class="op">)</span> <span class="op">+</span> <span class="va">type</span> <span class="op">+</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">SAPSadmission</span> <span class="op">+</span>
   <span class="fu"><a href="https://rdrr.io/pkg/mgcv/man/te.html">te</a></span><span class="op">(</span><span class="va">day_latency</span>, <span class="va">SOFA</span>, by <span class="op">=</span> <span class="va">LL</span><span class="op">)</span>,
  method <span class="op">=</span> <span class="st">"REML"</span>, offset <span class="op">=</span> <span class="va">offset</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">poisson</a></span><span class="op">(</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">ped</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Family: poisson 
## Link function: log 
## 
## Formula:
## ped_status ~ s(tend) + type + gender + SAPSadmission + te(day_latency, 
##     SOFA, by = LL)
## 
## Parametric coefficients:
##                 Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   -1.423e+01  4.304e+00  -3.307 0.000943 ***
## typeSurgical  -6.229e-01  2.751e-01  -2.264 0.023551 *  
## gender1       -2.211e-01  2.354e-01  -0.939 0.347707    
## SAPSadmission -3.738e-04  7.893e-03  -0.047 0.962226    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Approximate significance of smooth terms:
##                           edf Ref.df Chi.sq p-value    
## s(tend)                 1.000  1.000  2.269   0.132    
## te(day_latency,SOFA):LL 5.395  6.046 65.433  &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## R-sq.(adj) =  0.121   Deviance explained = 22.5%
## -REML =  258.2  Scale est. = 1         n = 1514</code></pre>
</div>
<div id="interpretation" class="section level3">
<h3 class="hasAnchor">
<a href="#interpretation" class="anchor"></a>Interpretation</h3>
<p>Interpretation of the estimated cumulative effects is best performed by visualization of either the partial effects or the cumulative effect. <strong><code>pammtools</code></strong> provides a couple of convenience functions that facilitate this process:</p>
<ul>
<li>
<code>gg_tensor</code>: This visualizes 2D effect surfaces as heat maps/contour plots and is based on the output of <code><a href="https://rdrr.io/pkg/mgcv/man/plot.gam.html">mgcv::plot.gam</a></code>
</li>
<li>
<code>gg_partial</code> and <code>gg_partial_ll</code>: The former visualizes the estimated partial effect, e.g., <span class="math inline">\(\hat h(t-t_z, z(t_z))\)</span> for each combination of the (specified) input, the latter visualizes the partial effects as a heat-map within the specified lag-lead window (this makes it easier to see which partial effects actually contribute to the cumulative effect in a specific interval)</li>
<li>
<code>gg_slice</code>: Plots 1D slices of 2D surfaces and can be used more generally to plot covariate effects conditional on pre-specified values of other covariates.</li>
<li>
<code>gg_cumu_eff</code>: Either plots the estimated cumulative effect <span class="math inline">\(\hat g(\mathbf{z}, t)\)</span> for a given <span class="math inline">\(\mathbf{z}\)</span> or the (log-) hazard ratio <span class="math inline">\(\log\left(\frac{\hat g(\mathbf{z}_1, t)}{\hat g(\mathbf{z}_2, t)}\right)\)</span>
</li>
</ul>
<p>Note that for each of these plot functions there are respective functions to retrieve the data used for plotting such that the plots can be generated and customized manually (see especially examples in <code>make_newdata</code>).</p>
<div id="d-partial-effect-surface" class="section level4">
<h4 class="hasAnchor">
<a href="#d-partial-effect-surface" class="anchor"></a>2D partial effect surface</h4>
<p>The code below visualizes the estimated 2D partial effect <span class="math inline">\(\hat h(t-t_z, z(t_z))\)</span> for each combination of latency and SOFA score (including confidence intervals). The gray areas indicate combinations that did not occur in the data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gg_tensor.html">gg_tensor</a></span><span class="op">(</span><span class="va">mod</span>, ci <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"SOFA"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"latency (day)"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></code></pre></div>
<p><img src="cumulative-effects_files/figure-html/unnamed-chunk-12-1.png" width="650px" style="display: block; margin: auto;"></p>
<p>This illustrates that a low SOFA score substantially increases the log-hazard if it was observed recently (latency <span class="math inline">\(&lt;\)</span> 2 days), while partial effects of the SOFA score observed further in the past (latency <span class="math inline">\(&gt;\)</span> 3 days) go towards zero (the event of interest is “extubation”, therefore increased (log-)hazards imply increased probabilities of extubation). Note that for this graphic, the function <span class="math inline">\(\hat h(t-t_z, z(t_z))\)</span> is evaluated at values of <span class="math inline">\(t-t_z\)</span> (<code>day_latency</code>) that are not present in the data.</p>
<p>Alternatively, the function <code>gg_partial</code> can be used to produce similar visualizations and allows more control over the inputs. For example, the following code produces the partial effect surface plot evaluated only at latencies 0 through 5 and calculates the partial effects relative to a patient with SOFA score 10 (everything else being equal):</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/gg_partial.html">gg_partial</a></span><span class="op">(</span><span class="va">ped</span>, <span class="va">mod</span>, term <span class="op">=</span> <span class="st">"SOFA"</span>, day_latency <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">5</span>,
  SOFA <span class="op">=</span> <span class="fu"><a href="../reference/seq_range.html">seq_range</a></span><span class="op">(</span><span class="va">SOFA</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>, LL <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, reference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>SOFA <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="cumulative-effects_files/figure-html/unnamed-chunk-13-1.png" width="400px" style="display: block; margin: auto;"> See also <code>gg_partial_ll</code> that shows the lag-lead window and partial effects that contribute to the cumulative effect in each interval. Due to the definition of the partial effect, however, these are constant in this case, as no time-variation was specified.</p>
</div>
<div id="d-conditional-effects-slices-through-the-2d-surface" class="section level4">
<h4 class="hasAnchor">
<a href="#d-conditional-effects-slices-through-the-2d-surface" class="anchor"></a>1D conditional effects (slices through the 2D surface):</h4>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_slice_latency</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg_slice.html">gg_slice</a></span><span class="op">(</span><span class="va">ped</span>, <span class="va">mod</span>, term <span class="op">=</span> <span class="st">"SOFA"</span>,
  day_latency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">day_latency</span><span class="op">)</span>, SOFA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">p_slice_sofa</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gg_slice.html">gg_slice</a></span><span class="op">(</span><span class="va">ped</span>, <span class="va">mod</span>, term <span class="op">=</span> <span class="st">"SOFA"</span>,
  day_latency <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, SOFA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">SOFA</span><span class="op">)</span><span class="op">)</span>
<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p_slice_latency</span>, <span class="va">p_slice_sofa</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="cumulative-effects_files/figure-html/unnamed-chunk-14-1.png" width="650px" style="display: block; margin: auto;"></p>
<p>These plots contain essentially the same information as the 2D surface, but focus on isolating the effects of the individual variables. This can be especially useful for three-dimensional partial effects which are hard to visualize otherwise.</p>
</div>
<div id="cumulative-effects" class="section level4">
<h4 class="hasAnchor">
<a href="#cumulative-effects" class="anchor"></a>Cumulative effects</h4>
<p>Since it can be difficult to assess how the estimated partial effects actually affect estimated hazard rates, <strong><code>pammtools</code></strong> provides additional functions to visualize and compare estimated cumulative effects on the level of the (log-)hazard rates for given TDCs <span class="math inline">\(\mathbf{z}\)</span>.</p>
<p>Below, we visualize the cumulative effect in each interval of the follow-up. Since the effect depends on a TDC <span class="math inline">\(\mathbf{z}\)</span>, its values must be provided in the call to <code>gg_cumu_eff</code> as <code>z1</code> argument (either length 1 for time-constant values or length equal to maximum number of times <span class="math inline">\(z(t_z)\)</span> was observed). If <code>z2</code> is additionally specified, the log-hazard ratio is calculated as <span class="math inline">\(\log\left(\frac{\hat g(\mathbf{z}_1, t)}{\hat g(\mathbf{z}_2, t)}\right)\)</span>. Below, two such log-hazard ratios are visualized for two different comparisons of SOFA score profiles:</p>
<ul>
<li>On the left hand side, a patient with SOFA scores continuously decreasing throughout the follow-up is compared to a patient with constant SOFA score of 10</li>
<li>On the right hand side, a patient with SOFA scores increasing throughout the follow-up is compared to a patient with SOFA score 0 on the first 10 days, score 20 on the following 20 days and score 5 on the last 20 days of the follow-up.</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p_cumu1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cumu_eff.html">gg_cumu_eff</a></span><span class="op">(</span><span class="va">ped</span>, <span class="va">mod</span>, term <span class="op">=</span> <span class="st">"SOFA"</span>,
  z1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">0</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>, z2 <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">25</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="va">p_cumu2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_cumu_eff.html">gg_cumu_eff</a></span><span class="op">(</span><span class="va">ped</span>, <span class="va">mod</span>, term <span class="op">=</span> <span class="st">"SOFA"</span>,
    z1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, length.out <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>,
    z2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">rel</a></span><span class="op">(</span><span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">30</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p_cumu1</span>, <span class="va">p_cumu2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="cumulative-effects_files/figure-html/unnamed-chunk-15-1.png" width="650px" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-Bender2018f">
<p>Bender, Andreas, and Fabian Scheipl. 2018. “Pammtools: Piece-Wise Exponential Additive Mixed Modeling Tools.” <em>arXiv:1806.01042 [Stat]</em>. <a href="http://arxiv.org/abs/1806.01042">http://arxiv.org/abs/1806.01042</a>.</p>
</div>
<div id="ref-Gasparrini2017">
<p>Gasparrini, Antonio, Fabian Scheipl, Ben Armstrong, and Michael G. Kenward. 2017. “A Penalized Framework for Distributed Lag Non-Linear Models.” <em>Biometrics</em> 73: 938–48. <a href="https://doi.org/10.1111/biom.12645">https://doi.org/10.1111/biom.12645</a>.</p>
</div>
<div id="ref-Heyard2018">
<p>Heyard, Rachel, Jean-François Timsit, Wafa Ibn Essaied, and Leonhard Held. 2018. “Dynamic Clinical Prediction Models for Discrete Time-to-Event Data with Competing Risks—A Case Study on the OUTCOMEREA Database.” <em>Biometrical Journal</em> 0 (0). <a href="https://doi.org/10.1002/bimj.201700259">https://doi.org/10.1002/bimj.201700259</a>.</p>
</div>
<div id="ref-Sylvestre2009">
<p>Sylvestre, Marie-Pierre, and Michal Abrahamowicz. 2009. “Flexible Modeling of the Cumulative Effects of Time-Dependent Exposures on the Hazard.” <em>Statistics in Medicine</em> 28 (27): 3437–53. <a href="https://doi.org/10.1002/sim.3701">https://doi.org/10.1002/sim.3701</a>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Andreas Bender, Fabian Scheipl, Philipp Kopper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c3726dcbf089f0b26f496305ed030c22',
    indexName: 'pammtools',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
